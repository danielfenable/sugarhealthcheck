/*
     YUI 3.15.0 (build 834026e)
     Copyright 2014 Yahoo! Inc. All rights reserved.
     Licensed under the BSD License.
     http://yuilibrary.com/license/
     */
YUI.add('editor-bidi',function(Y,NAME){var EditorBidi=function(){EditorBidi.superclass.constructor.apply(this,arguments);},HOST='host',DIR='dir',NODE_CHANGE='nodeChange',B_C_CHANGE='bidiContextChange',STYLE='style';Y.extend(EditorBidi,Y.Base,{lastDirection:null,firstEvent:null,_checkForChange:function(){var host=this.get(HOST),inst=host.getInstance(),sel=new inst.EditorSelection(),node,direction;if(sel.isCollapsed){node=EditorBidi.blockParent(sel.focusNode,false,inst.EditorSelection.ROOT);if(node){direction=node.getStyle('direction');if(direction!==this.lastDirection){host.fire(B_C_CHANGE,{changedTo:direction});this.lastDirection=direction;}}}else{host.fire(B_C_CHANGE,{changedTo:'select'});this.lastDirection=null;}},_afterNodeChange:function(e){if(this.firstEvent||EditorBidi.EVENTS[e.changedType]){this._checkForChange();this.firstEvent=false;}},_afterMouseUp:function(){this._checkForChange();this.firstEvent=false;},initializer:function(){var host=this.get(HOST);this.firstEvent=true;host.after(NODE_CHANGE,Y.bind(this._afterNodeChange,this));host.after('dom:mouseup',Y.bind(this._afterMouseUp,this));}},{EVENTS:{'backspace-up':true,'pageup-up':true,'pagedown-down':true,'end-up':true,'home-up':true,'left-up':true,'up-up':true,'right-up':true,'down-up':true,'delete-up':true},BLOCKS:Y.EditorSelection.BLOCKS,DIV_WRAPPER:'<DIV></DIV>',blockParent:function(node,wrap,root){var parent=node,divNode,firstChild;root=root||Y.EditorSelection.ROOT;if(!parent){parent=root;}
if(!parent.test(EditorBidi.BLOCKS)){parent=parent.ancestor(EditorBidi.BLOCKS);}
if(wrap&&parent.compareTo(root)){divNode=Y.Node.create(EditorBidi.DIV_WRAPPER);parent.get('children').each(function(node,index){if(index===0){firstChild=node;}else{divNode.append(node);}});firstChild.replace(divNode);divNode.prepend(firstChild);parent=divNode;}
return parent;},_NODE_SELECTED:'bidiSelected',addParents:function(nodeArray,root){var i,parent,addParent;tester=function(sibling){if(!sibling.getData(EditorBidi._NODE_SELECTED)){addParent=false;return true;}};root=root||Y.EditorSelection.ROOT;for(i=0;i<nodeArray.length;i+=1){nodeArray[i].setData(EditorBidi._NODE_SELECTED,true);}
for(i=0;i<nodeArray.length;i+=1){parent=nodeArray[i].get('parentNode');if(!root.compareTo(parent)&&!parent.getData(EditorBidi._NODE_SELECTED)){addParent=true;parent.get('children').some(tester);if(addParent){nodeArray.push(parent);parent.setData(EditorBidi._NODE_SELECTED,true);}}}
for(i=0;i<nodeArray.length;i+=1){nodeArray[i].clearData(EditorBidi._NODE_SELECTED);}
return nodeArray;},NAME:'editorBidi',NS:'editorBidi',ATTRS:{host:{value:false}},RE_TEXT_ALIGN:/text-align:\s*\w*\s*;/,removeTextAlign:function(n){if(n){if(n.getAttribute(STYLE).match(EditorBidi.RE_TEXT_ALIGN)){n.setAttribute(STYLE,n.getAttribute(STYLE).replace(EditorBidi.RE_TEXT_ALIGN,''));}
if(n.hasAttribute('align')){n.removeAttribute('align');}}
return n;}});Y.namespace('Plugin');Y.Plugin.EditorBidi=EditorBidi;Y.Plugin.ExecCommand.COMMANDS.bidi=function(cmd,direction){var inst=this.getInstance(),sel=new inst.EditorSelection(),ns=this.get(HOST).get(HOST).editorBidi,returnValue,block,b,root=inst.EditorSelection.ROOT,selected,selectedBlocks,dir;if(!ns){Y.error('bidi execCommand is not available without the EditorBiDi plugin.');return;}
inst.EditorSelection.filterBlocks();if(sel.isCollapsed){block=EditorBidi.blockParent(sel.anchorNode,false,root);if(!block){block=root.one(inst.EditorSelection.BLOCKS);}
block=EditorBidi.removeTextAlign(block);if(!direction){dir=block.getAttribute(DIR);if(!dir||dir==='ltr'){direction='rtl';}else{direction='ltr';}}
block.setAttribute(DIR,direction);if(Y.UA.ie){b=block.all('br.yui-cursor');if(b.size()===1&&block.get('childNodes').size()===1){b.remove();}}
returnValue=block;}else{selected=sel.getSelected();selectedBlocks=[];selected.each(function(node){selectedBlocks.push(EditorBidi.blockParent(node,false,root));});selectedBlocks=inst.all(EditorBidi.addParents(selectedBlocks,root));selectedBlocks.each(function(n){var d=direction;n=EditorBidi.removeTextAlign(n);if(!d){dir=n.getAttribute(DIR);if(!dir||dir==='ltr'){d='rtl';}else{d='ltr';}}
n.setAttribute(DIR,d);});returnValue=selectedBlocks;}
ns._checkForChange();return returnValue;};},'3.15.0',{"requires":["editor-base"]});