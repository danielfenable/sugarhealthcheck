
(function(app){app.events.on("app:init",function(){var routes,homeOptions={dashboard:'dashboard',activities:'activities'},getLastHomeKey=function(){return app.user.lastState.buildKey('last-home','app-header');};routes=[{name:"index",route:""},{name:"logout",route:"logout/?clear=:clear"},{name:"logout",route:"logout"},{name:"forgotpassword",route:"forgotpassword",callback:function(){app.controller.loadView({module:"Forgotpassword",layout:"forgotpassword",create:true});}},{name:"home",route:"Home",callback:function(){var lastHomeKey=getLastHomeKey(),lastHome=app.user.lastState.get(lastHomeKey);if(lastHome===homeOptions.dashboard){app.router.list("Home");}else if(lastHome===homeOptions.activities){app.router.redirect('#activities');}}},{name:'about',route:'about',callback:function(){app.controller.loadView({layout:'about',module:'Home',skipFetch:true});}},{name:'activities',route:'activities',callback:function(){var lastHomeKey=getLastHomeKey();app.user.lastState.set(lastHomeKey,homeOptions.activities);app.controller.loadView({layout:'activities',module:'Activities'});}},{name:'profile',route:'profile',callback:function(){var route=app.bwc.buildRoute('Users',app.user.get('id'));app.router.navigate(route,{trigger:true,replace:true});}},{name:"bwc",route:"bwc/*url",callback:function(url){app.logger.debug("BWC: "+url);var frame=$('#bwc-frame');if(frame.length===1&&app.utils.rmIframeMark('index.php'+frame.get(0).contentWindow.location.search)===url){return;}
if(url==='index.php'){app.router.navigate('#Home',{trigger:true});return;}
var params={layout:'bwc',url:url};var module=/module=([^&]*)/.exec(url);if(!_.isNull(module)&&!_.isEmpty(module[1])){params.module=module[1];if(module[1]==='Import'){module=/import_module=([^&]*)/.exec(url);if(!_.isNull(module)&&!_.isEmpty(module[1])){params.module=module[1];}}}
app.controller.loadView(params);}},{name:"sg_index",route:"Styleguide",callback:function(){app.controller.loadView({module:"Styleguide",layout:"styleguide",page_name:"home"});}},{name:"sg_module",route:"Styleguide/:layout/:resource",callback:function(layout,resource){var page='',field='';if(layout==='field'){page='field';field=resource;}else if(layout==='view'){page='layouts_'+resource;}else if(layout==='docs'){page=resource;}else if(layout==='layout'){layout=resource;page='module';}
app.controller.loadView({module:"Styleguide",layout:layout,page_name:page,field_type:field,skipFetch:true});}},{name:'search',route:'search(/)(:searchTermAndParams)',callback:function(searchTermAndParams){var searchTerm='';var params={modules:[],tags:[]};if(searchTermAndParams){var uriSplit=searchTermAndParams.split('?');searchTerm=decodeURIComponent(uriSplit[0]);if(uriSplit.length>1){var paramsArray=uriSplit[1].split('&');_.each(paramsArray,function(paramPair){var keyValueArray=paramPair.split('=');if(keyValueArray.length>1){params[keyValueArray[0]]=keyValueArray[1].split(',');}});}}
var appContext=app.controller.context;var termHasChanged=appContext.get('searchTerm')!==searchTerm;var modulesHaveChanged=!_.isEqual(appContext.get('module_list'),params.modules);params.tags=_.map(params.tags,function(tag){return decodeURIComponent(tag);});var tagsHaveChanged=!_.isEqual(appContext.get('tagParams'),params.tags);if(termHasChanged){appContext.set('searchTerm',searchTerm);}
if(modulesHaveChanged){appContext.set('module_list',params.modules);}
if(tagsHaveChanged){appContext.set('tagParams',params.tags);}
if(tagsHaveChanged){appContext.trigger('tagsearch:fire:new')}else if(termHasChanged||modulesHaveChanged){appContext.trigger('search:fire:new');}
var header=app.additionalComponents.header;var quicksearch=header&&header.getComponent('quicksearch');if(quicksearch){quicksearch.trigger('route:search');}
if(appContext&&appContext.get('search')){return;}
app.controller.loadView({layout:'search',searchTerm:searchTerm,module_list:params.modules,tagParams:params.tags,mixed:true});}},{name:"list",route:":module"},{name:'create',route:':module/create',callback:function(module){if(module==='Home'){app.controller.loadView({module:module,layout:'record'});return;}
if(!app.router._moduleExists(module)){return;}
var prevLayout=app.controller.context.get('layout');if(prevLayout&&prevLayout!=='login'){app.drawer.open({layout:'create',context:{module:module,create:true,fromRouter:true}},function(context,model){if(model&&model.module===app.controller.context.get('module')){app.controller.context.reloadData();}});return;}
app.router.record(module,'create');}},{name:"vcardImport",route:":module/vcard-import",callback:function(module){if(!app.router._moduleExists(module)){return;}
app.controller.loadView({module:module,layout:"records"});app.drawer.open({layout:'vcard-import'},_.bind(function(){var route=app.router.buildRoute(module);app.router.navigate(route,{replace:true});},this));}},{name:"editAllRecurrences",route:":module/:id/edit/all-recurrences",callback:function(module,id){if(!app.router._moduleExists(module)){return;}
app.controller.loadView({module:module,layout:'record',action:'edit',modelId:id,all_recurrences:true});}},{name:"layout",route:":module/layout/:view"},{name:'config',route:':module/config',callback:function(module){if(!app.router._moduleExists(module)){return;}
var prevLayout=app.controller.context.get('layout');if(prevLayout&&prevLayout!=='login'){app.drawer.open({layout:'config-drawer',context:{module:module,fromRouter:true}});return;}
app.controller.loadView({layout:'config-drawer',module:module});}},{name:"homeRecord",route:"Home/:id",callback:function(id){var lastHomeKey=getLastHomeKey();app.user.lastState.set(lastHomeKey,homeOptions.dashboard);app.router.record("Home",id);}},{name:"record",route:":module/:id"},{name:"record",route:":module/:id/:action"},{name:"record_layout",route:":module/:id/layout/:view",callback:function(module,id,view){if(!app.router._moduleExists(module)){return;}
app.router.record(module,id,null,view);}},{name:"record_layout_action",route:":module/:id/layout/:view/:action",callback:function(module,id,layout,action){if(!app.router._moduleExists(module)){return;}
app.router.record(module,id,action,layout);}},{name:"not_found",route:/^.*$/,callback:function(){app.error.handleHttpError({status:404});}}];app.routing.setRoutes(routes);app.api.setRefreshTokenSuccessCallback(function(callback){callback();app.events.trigger("api:refreshtoken:success");});});app.routing.before('route',function(options){var hasAccess=app.router.hasAccessToModule(options)!==false,isBwcRedirect=app.router.bwcRedirect(options)!==false;return hasAccess&&isBwcRedirect;});var titles={'records':'TPL_BROWSER_SUGAR7_RECORDS_TITLE','record':'TPL_BROWSER_SUGAR7_RECORD_TITLE','about':'TPL_BROWSER_SUGAR7_ABOUT_TITLE','activities':'TPL_BROWSER_SUGAR7_RECORD_TITLE'};var getTitle=function(model){var context=app.controller.context,module=context.get('module'),template=Handlebars.compile(app.lang.get(titles[context.get('layout')],module)||''),moduleName=app.lang.getModuleName(module,{plural:true}),title;title=template(_.extend({module:moduleName,appId:app.config.systemName||app.config.appId},model?model.attributes:{}));return $('<span/>').html(title).text();};var setTitle=function(model){var title=getTitle(model);document.title=title||document.title;};var prevModel;app.events.on("app:view:change",function(){var context=app.controller.context,module=context.get("module"),metadata=app.metadata.getModule(module),title;if(prevModel){prevModel.off("change",setTitle);}
if(_.isEmpty(metadata)||metadata.isBwcEnabled){title=$('#bwc-frame').get(0)?$('#bwc-frame').get(0).contentWindow.document.title:getTitle();}else{var currModel=context.get('model');if(!_.isEmpty(currModel)){title=getTitle(currModel);currModel.on("change",setTitle,this);app.controller.layout.once("dispose",function(){currModel.off("change",setTitle);});prevModel=currModel;}else{title=getTitle();}}
document.title=title||document.title;},this);var refreshExternalLogin=function(){var config=app.metadata.getConfig();app.api.setExternalLogin(config&&config['externalLogin']);if(config&&(_.isNull(config['externalLoginSameWindow'])||config['externalLoginSameWindow']===false)){app.api.setExternalLoginUICallback(window.open);}};app.events.on("app:sync:complete",refreshExternalLogin,this);app.events.on("app:init",refreshExternalLogin,this);app.Router=app.Router.extend({bwcRedirect:function(options){if(options&&_.isArray(options.args)&&options.args[0]){var module=options.args[0],id=options.args[1],action=id?'DetailView':'index',meta=app.metadata.getModule(module);if(meta&&meta.isBwcEnabled){var sidecarAction=options.args[2]||options.route,bwcAction=app.bwc.getAction(sidecarAction);if(bwcAction!==sidecarAction){action=bwcAction;}
var redirect='bwc/index.php?module='+module+'&action='+action;if(id){redirect+='&record='+id;}
_.defer(function(){app.router.navigate(redirect,{trigger:true,replace:true});});return false;}}
return true;},hasAccessToModule:function(options){options=options||{};var checkAccessRoutes={'record':'view','create':'create','vcardImport':'create'},route=options.route||'',args=options.args||[],module=args[0],accessCheck=checkAccessRoutes[route];if(accessCheck&&!app.acl.hasAccess(accessCheck,module)){_.defer(function(){app.controller.loadView({layout:'access-denied'});});return false;}
var showWizard=false;if(app.user&&app.user.has('show_wizard')){showWizard=app.user.get('show_wizard');if(showWizard){var system_config=app.metadata.getConfig();if(system_config.system_status&&system_config.system_status.level&&system_config.system_status.level==='admin_only'){showWizard=false;}}}
if(showWizard){var callbacks={complete:function(){var module=app.utils.getWindowLocationParameterByName('module',window.location.search),action=app.utils.getWindowLocationParameterByName('action',window.location.search);if(_.isString(module)&&_.isString(action)&&module.toLowerCase()==='users'&&action.toLowerCase()==='authenticate'){window.location=window.location.pathname;}else{window.location.reload();}}};app.controller.loadView({layout:'first-login-wizard',module:'Users',modelId:app.user.get('id'),callbacks:callbacks,wizardName:app.user.get('type')});app.additionalComponents.header.hide();return false;}
if(route&&route!=='logout'&&app.user&&app.user.get('is_password_expired')){app.controller.loadView({layout:'password-expired',module:'Users',callbacks:{complete:function(){window.location.reload();}},modelId:app.user.get('id')});app.additionalComponents.header.hide();return false;}}});app.augment("progress",_.extend({init:function(){NProgress.configure({template:'<div class="loading gate">'+'    <div class="progress progress-danger">'+'        <div role="bar" class="bar"></div>'+'    </div>'+'</div>'});NProgress.start();NProgress.set(0.25);},hide:function(){$("#nprogress").hide();}},NProgress),false);app.events.on("app:logout:success",function(data){if(app.config&&app.config.externalLogin&&data&&data.url){if(!$('#logoutframe').length){$("#sugarcrm").append('<iframe id="logoutframe" />');$('#logoutframe').hide();}
$('#logoutframe').load(function(){$('#logoutframe').off('load');$('#logoutframe').attr('src','');});$('#logoutframe').attr('src',data.url);}});app.events.on('app:logout',function(){var filters=app.data.getCollectionClasses().Filters;if(filters){filters.prototype.resetFiltersCacheAndRequests();}});app.user.on('change:show_wizard',function(user,show_wizard){if(show_wizard){app.shortcuts.disable();}else{app.shortcuts.enable();}});})(SUGAR.App);
/* End of File include/javascript/sugar7.js */


(function(app){var Bwc={login:function(redirectUrl,callback){var url=app.api.buildURL('oauth2','bwc/login');return app.api.call('create',url,{},{success:function(data){if(data&&data.name){app.cache.set('SessionName',data.name);}
if(callback){callback();}
if(redirectUrl){app.router.navigate('#bwc/'+redirectUrl,{trigger:true});}}});},getAction:function(action){var bwcActions={'create':'EditView','edit':'EditView','detail':'DetailView'};return bwcActions[action]||action;},buildRoute:function(module,id,action,params){var href='bwc/index.php?',params=_.extend({},{module:module},params);if(!action&&!id||action==='DetailView'&&!id){params.action='index';}else{if(action){params.action=action;}else{params.action='DetailView';}
if(id){params.record=id;}}
return href+$.param(params);},_createRelatedRecordUrlParams:function(parentModel,link){var params={parent_type:parentModel.module,parent_name:parentModel.get('name')||parentModel.get('full_name')||app.utils.formatNameLocale(parentModel.attributes),parent_id:parentModel.get("id"),return_module:parentModel.module,return_id:parentModel.get("id"),return_name:parentModel.get('name')||parentModel.get('full_name')||app.utils.formatNameLocale(parentModel.attributes)};var linkField=_.find(parentModel.fields,function(field){return(field.type=='link'&&field.name==link)});if(linkField){params['return_relationship']=linkField.relationship;}
params=this._handleRelatedRecordSpecialCases(params,parentModel,link);var fields=app.data.getRelateFields(parentModel.module,link);_.each(fields,function(field){params[field.name]=parentModel.get(field.rname)||app.utils.formatNameLocale(parentModel.attributes);params[field.id_name]=parentModel.get("id");if(field.populate_list){_.each(field.populate_list,function(target,source){source=_.isNumber(source)?target:source;if(!_.isUndefined(parentModel.get(source))){params[target]=parentModel.get(source);}},this);}});return params;},_handleRelatedRecordSpecialCases:function(params,parentModel,link){var syncedAttributes=parentModel.getSynced();if(parentModel.module=='Contacts'&&parentModel.has('account_id')&&(link=='meetings'||link=='calls')){params=_.extend(params,{parent_type:'Accounts',parent_id:syncedAttributes.account_id||parentModel.get('account_id'),account_id:syncedAttributes.account_id||parentModel.get('account_id'),account_name:syncedAttributes.account_name||parentModel.get('account_name'),parent_name:syncedAttributes.account_name||parentModel.get('account_name'),contact_id:syncedAttributes.id||parentModel.get('id'),contact_name:syncedAttributes.full_name||parentModel.get('full_name')});}
if(link=='quotes'||link=='contracts'){if(parentModel.has('account_id')){params=_.extend(params,{account_id:syncedAttributes.account_id||parentModel.get('account_id'),account_name:syncedAttributes.account_name||parentModel.get('account_name')});}
if(parentModel.module==='Contacts'){params=_.extend(params,{contact_id:parentModel.get('id')});}else if(parentModel.has('contact_id')){params=_.extend(params,{contact_id:syncedAttributes.contact_id||parentModel.get('contact_id')});}}
return params;},createRelatedRecord:function(module,parentModel,link,id){var params=this._createRelatedRecordUrlParams(parentModel,link);var route=app.bwc.buildRoute(module,id||null,"EditView",params);app.router.navigate("#"+route,{trigger:true});},shareRecord:function(module,id,name){var shareField=app.view.createField({def:{type:'shareaction'},module:module,model:app.data.createBean(module,{id:id,name:name}),view:app.view.createView({})});if(shareField.useSugarEmailClient()){shareField.shareWithSugarEmailClient();}else{this._launchExternalEmail(shareField.getShareMailtoUrl());}},_launchExternalEmail:function(mailto){var tempMailTo=$('<a href="'+mailto+'"></a>').appendTo('body');tempMailTo.get(0).click();tempMailTo.remove();},revertAttributes:function(){var view=app.controller.layout.getComponent('bwc');if(!view){return;}
view.revertBwcModel();}};app.augment('bwc',_.extend(Bwc,Backbone.Events),false);})(SUGAR.App);
/* End of File include/javascript/sugar7/bwc.js */


(function(app){app.events.on("app:init",function(){var tooltipTemplate=Handlebars.compile('<div class="tooltip">'+'<div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>');var $tooltipTemplate=$(tooltipTemplate());app.utils=_.extend(app.utils,{tooltip:{initialize:function($elements,options,direction){options=options||{};_.each($elements,function(element){var $element=$(element);if(!$element.data('bs.tooltip')){var data=$element.data();if(direction){options.template=$tooltipTemplate.attr('dir',direction);}
$element.tooltip(_.extend({container:'body',trigger:'hover'},data,options));}});return $elements;},destroy:function($tooltips){$tooltips.tooltip('destroy');},show:function(element){var plugin;if(this.has(element)){plugin=this.get(element);plugin.enter(plugin);}},hide:function(element){var plugin;if(this.has(element)){plugin=this.get(element);plugin.leave(plugin);}},has:function(element){return!_.isUndefined(this.get(element));},get:function(element){return $(element).data('bs.tooltip');}},hideForecastCommitStageField:function(panels){var config=app.metadata.getModule('Forecasts','config'),isSetup=(config&&config.is_setup);if(!isSetup){_.each(panels,function(panel){_.every(panel.fields,function(field,index){if(field.name=='commit_stage'){panel.fields[index]={'name':'spacer','label':field.label,'span':6,'readonly':true};return false;}
return true;},this);},this);}},createHistoryLog:function(oldestModel,newestModel,isRepWorksheet){var labels=[];if(_.isEmpty(oldestModel)){oldestModel=new Backbone.Model({best_case:0,likely_case:0,worst_case:0,date_entered:''});labels.push('LBL_COMMITTED_HISTORY_SETUP_FORECAST');}else{labels.push('LBL_COMMITTED_HISTORY_UPDATED_FORECAST');}
var fields=['worst','likely','best'],final=[],num_shown=0,config=app.metadata.getModule('Forecasts','config'),aclModule=(isRepWorksheet)?config.forecast_by:newestModel.module;_.each(fields,function(field){var fieldName=field+'_case';if(config['show_worksheet_'+field]&&app.acl.hasAccess('view',aclModule,null,fieldName)){var diff=this.getDifference(oldestModel,newestModel,fieldName);num_shown++;if(diff!=0){var direction=this.getDirection(diff);final.push(this.gatherLangArgsByParams(direction,this.getArrowDirectionSpan(direction),diff,newestModel,fieldName));labels.push('LBL_COMMITTED_HISTORY_'+field.toUpperCase()+'_CHANGED');}else{final.push([]);labels.push('LBL_COMMITTED_HISTORY_'+field.toUpperCase()+'_SAME');}}},this);var lang_string_key='LBL_COMMITTED_HISTORY_'+num_shown+'_SHOWN',hb=Handlebars.compile('{{{str key module args}}}');final=this.parseArgsAndLabels(final,labels);var text=hb({'key':lang_string_key,'module':'Forecasts','args':final});return{'text':new Handlebars.SafeString(text),'text2':app.date(newestModel.get('date_modified')).formatUser(false,app.user)};},gatherLangArgsByParams:function(dir,arrow,diff,model,attrStr){return{'direction':new Handlebars.SafeString(app.lang.get(dir,'Forecasts')+arrow),'from':app.currency.formatAmountLocale(Math.abs(diff)),'to':app.currency.formatAmountLocale(model.get(attrStr))};},getArrowDirectionSpan:function(directionClass){return directionClass=='LBL_UP'?'&nbsp;<i class="fa fa-arrow-up font-green"></i>':directionClass=='LBL_DOWN'?'&nbsp;<i class="fa fa-arrow-down font-red"></i>':'';},getForecastType:function(isManager,showOpps){return(!showOpps&&isManager)?'Rollup':'Direct';},parseArgsAndLabels:function(argsArray,labels){var retArgs={},argsKeys=['first','second','third'],hb=Handlebars.compile('{{{str key module args}}}');if((argsArray.length+1)!=labels.length){var msg='ForecastsUtils.parseArgsAndLabels() :: '+'argsArray and labels params are not the same length';app.logger.error(msg);return null;}
retArgs.intro=hb({'key':_.first(labels),'module':'Forecasts','args':[]});labels=_.last(labels,labels.length-1);_.each(labels,function(label,index){retArgs[argsKeys[index]]=hb({'key':label,'module':'Forecasts','args':argsArray[index]});});return retArgs;},getDifference:function(oldModel,newModel,attr){return(app.math.isDifferentWithPrecision(newModel.get(attr),oldModel.get(attr)))?app.math.getDifference(newModel.get(attr),oldModel.get(attr)):0;},getDirection:function(difference){return difference>0?'LBL_UP':(difference<0?'LBL_DOWN':'');},getSubpanelList:function(module){var list={},subpanels=app.metadata.getModule(module),comps;if(subpanels&&subpanels.layouts){subpanels=subpanels.layouts.subpanels;if(subpanels&&subpanels.meta){if(subpanels.meta.dynamic){comps=this.getDynamicSubpanelList(module);if(comps&&comps.meta){comps=comps.meta.components||[];}}else{comps=subpanels.meta.components||[];}}}
if(comps){_.each(comps,function(comp){if(comp.context&&comp.context.link){list[comp.label]=comp.context.link;}else{app.logger.warning("Subpanel's subpanels.meta.components "
+"has component with no context or context.link");}});}
return list;},getDynamicSubpanelList:function(module){var dSubpanels=this.getDynamicSubpanelMetadata(module);return{meta:dSubpanels};},getDynamicSubpanelMetadata:function(module){var rels=app.metadata.get().relationships,fields=app.metadata.getModule(module).fields,modules=app.metadata.getModules(),comps=[],self=this;_.each(fields,function(fDefs,fName){var relModule,relDefName,spLabel;if(fDefs.type&&fDefs.type==='link'&&fDefs.relationship){relDefName=fDefs.relationship;if(self.hasDynamicSubpanelDef(rels,relDefName,module)){relModule=rels[relDefName].lhs_module;if(modules[relModule]){var layoutName='subpanel';if(modules[relModule].additionalProperties&&modules[relModule].additionalProperties.dynamic_subpanel_name){layoutName=modules[relModule].additionalProperties.dynamic_subpanel_name;}
comps.push({context:{link:fDefs.name},label:self.getDynamicSubpanelLabel(module,relModule),layout:layoutName});}}}});return{components:comps};},getDynamicSubpanelLabel:function(module,relModule){var lIndex='LBL_'+relModule.toUpperCase()+'_SUBPANEL_TITLE';var stackDef=[{key:'LBL_DEFAULT_SUBPANEL_TITLE',mod:relModule},{key:lIndex,mod:module},{key:lIndex,mod:relModule},{key:'LBL_MODULE_NAME',mod:relModule}];var label;for(var i in stackDef){if(label=app.lang.getModString(stackDef[i].key,stackDef[i].mod)){return label;}}
return relModule;},hasDynamicSubpanelDef:function(rels,relDefName,module){return rels[relDefName]&&rels[relDefName].dynamic_subpanel&&rels[relDefName].lhs_module&&rels[relDefName].rhs_module&&rels[relDefName].rhs_module===module;},isRequiredLink:function(module,link){var relatedFields=app.data.getRelateFields(module,link),requiredField=_.some(relatedFields,function(field){return field.required===true;},this);return requiredField;},_tableColumnsConfigKeyMapManager:{'likely_case':'show_worksheet_likely','likely_case_adjusted':'show_worksheet_likely','best_case':'show_worksheet_best','best_case_adjusted':'show_worksheet_best','worst_case':'show_worksheet_worst','worst_case_adjusted':'show_worksheet_worst'},_tableColumnsConfigKeyMapRep:{'likely_case':'show_worksheet_likely','best_case':'show_worksheet_best','worst_case':'show_worksheet_worst'},getColumnVisFromKeyMap:function(key,viewName){var moduleMap={'forecastsWorksheet':'rep','forecastsWorksheetTotals':'rep','forecastsWorksheetManager':'mgr','forecastsWorksheetManagerTotals':'mgr'},whichKeyMap,keyMap,returnValue;whichKeyMap=moduleMap[viewName];keyMap=(whichKeyMap==='rep')?this._tableColumnsConfigKeyMapRep:this._tableColumnsConfigKeyMapManager;returnValue=app.metadata.getModule('Forecasts','config')[keyMap[key]];if(!_.isUndefined(returnValue)){returnValue=returnValue==1}else{returnValue=true;}
return returnValue;},getSelectedUsersReportees:function(selectedUser,context){if(selectedUser.is_manager){if(_.isUndefined(selectedUser.reportees)){selectedUser.reportees=[];}
var url=app.api.buildURL('Users','filter'),post_args={"filter":[{'reports_to_id':selectedUser.id,'status':'Active'}],'fields':'full_name','max_num':1000},options={};options.success=_.bind(function(resp,status,xhr){_.each(resp.records,function(user){selectedUser.reportees.push({id:user.id,name:user.full_name});});this.set("selectedUser",selectedUser)},context);app.api.call("create",url,post_args,options);}else{context.set("selectedUser",selectedUser);}},checkForecastConfig:function(){var forecastConfigOK=true,cfg=app.metadata.getModule('Forecasts','config')||{},salesWonVals=cfg.sales_stage_won,salesLostVals=cfg.sales_stage_lost,salesWonLostVals=cfg.sales_stage_won.concat(cfg.sales_stage_lost),domVals=app.lang.getAppListStrings('sales_stage_dom');if(salesWonVals.length==0||salesLostVals.length==0||_.isEmpty(domVals)){forecastConfigOK=false;}else{forecastConfigOK=_.every(salesWonLostVals,function(val){return(val!=''&&_.has(domVals,val));},this);}
return forecastConfigOK;},isTouchDevice:function(){return Modernizr.touch;},customBuildRoute:function(moduleOrContext,id,action,inBwc){var module,moduleMeta;if(_.isEmpty(moduleOrContext)){return'';}
if(_.isString(moduleOrContext)){module=moduleOrContext;}else{module=moduleOrContext.get('module');}
if(_.isEmpty(module)||!app.bwc){return'';}
moduleMeta=app.metadata.getModule(module)||{};if(inBwc===false||(_.isUndefined(inBwc)&&!moduleMeta.isBwcEnabled)){return'';}
return app.bwc.buildRoute(module,id,app.bwc.getAction(action));},addIframeMark:function(url){var parts=url.split('?');if(parts[1]&&parts[1].indexOf('bwcFrame=1')!=-1)return url;return parts[0]+'?'+(parts[1]?parts[1]+'&bwcFrame=1':'bwcFrame=1');},rmIframeMark:function(url){var parts=url.split('?');if(!parts[1]){return url;}
return parts[0]+'?'+_.reduce(parts[1].split('&'),function(acc,item){if(item=='bwcFrame=1'){return acc;}else{return acc?acc+'&'+item:item;}},'');},getSubpanelCollection:function(ctx,module){var retCollection=undefined,mdl=_.find(ctx.children,function(child){return(child.get('module')==module);});if(mdl&&_.has(mdl.attributes,'collection')){retCollection=mdl.get('collection');}
return retCollection;},getRecordName:function(model){if(model.module==='Documents'&&model.has('document_name')){return model.get('document_name');}else if(model.has('full_name')){return model.get('full_name');}else if(model.has('first_name')&&model.has('last_name')){return model.get('first_name')+' '+model.get('last_name');}else if(model.has('last_name')){return model.get('last_name');}else{return model.get('name')||'';}},resolve409Conflict:function(error,model,callback){app.drawer.open({layout:'resolve-conflicts',context:{dataInDb:error.payload.record,modelToSave:model}},callback);},getForecastNotSetUpMessage:function(isAdmin){var langKey=(isAdmin)?'LBL_DASHLET_FORECAST_NOT_SETUP_ADMIN':'LBL_DASHLET_FORECAST_NOT_SETUP',msg=app.lang.get(langKey,'Forecasts');if(isAdmin){var linkText=app.lang.get('LBL_DASHLET_FORECAST_CONFIG_LINK_TEXT','Forecasts');msg+='  <a href="#Forecasts/config">'+linkText+'</a>';}
return msg;},getWindowLocationParameterByName:function(name,queryString){name=name.replace(/[\[]/,'\\[').replace(/[\]]/,'\\]');var regex=new RegExp('[\\?&]'+name+'=([^&#]*)','g'),matchResults=queryString.match(regex);if(matchResults&&matchResults.length>0){var results=regex.exec(matchResults[matchResults.length-1]);}
return(results===undefined||results===null)?'':decodeURIComponent(results[1].replace(/\+/g,' '));},isTruthy:function(value){if(_.isString(value)){value=value.toLowerCase();}
return value===true||value==='true'||value===1||value==='1'||value==='on'||value==='yes';}});});})(SUGAR.App);
/* End of File include/javascript/sugar7/utils.js */


(function(app){app.events.on('app:init',function(){app.utils=_.extend(app.utils,{'FilterOptions':Backbone.Model.extend({initialize:function(options){this._filterPopulateNames=[];this._filterRelate=null;},setFilterRelate:function(value){if(!_.isObject(value)||_.isEmpty(value)){return this;}
this._filterRelate=value;this.set('stickiness',false);return this;},setFilterPopulate:function(value){if(!_.isObject(value)||_.isEmpty(value)){return this;}
this.set('filter_populate',value);this.set('stickiness',false);return this;},setInitialFilter:function(id){this.set('initial_filter',id);return this;},setInitialFilterLabel:function(name){this.set('initial_filter_label',name);return this;},setLangModules:function(modules){if(!_.isArray(modules)){return;}
this.set('initial_filter_lang_modules',modules);},relateInitialFilterLabel:function(){this.set('initial_filter_label',this._filterPopulateNames.join(', '));return this;},config:function(options){options=options||{};this.setInitialFilter(options.initial_filter);this.setInitialFilterLabel(options.initial_filter_label);this.setFilterPopulate(options.filter_populate);this.setFilterRelate(options.filter_relate);return this;},populateRelate:function(relateModel){if(_.isEmpty(this._filterRelate)){return this;}
var filterPopulate=this.get('filter_populate')||{};_.each(this._filterRelate,function(toField,fromField){filterPopulate[toField]={$in:[relateModel.get(fromField)]};var relateNameField=_.find(relateModel.fields,function(field){return field.id_name===fromField;});if(relateNameField){this._filterPopulateNames.push(relateModel.get(relateNameField.name));}},this);this.set('filter_populate',filterPopulate);if(!this.get('initial_filter_label')){this.relateInitialFilterLabel();}
return this;},format:function(){if(!this.get('initial_filter')||!this.get('filter_populate')){return;}
return this.toJSON();}})});});})(SUGAR.App);
/* End of File include/javascript/sugar7/utils-filters.js */


(function(app){app.events.on('app:init',function(){app.utils=_.extend(app.utils,{'GlobalSearch':{formatRecords:function(collection,linkableHighlights){collection.each(function(model){if(model.formatted){return;}
var module=app.metadata.getModule(model.get('_module'));var nameFormatValues=_.values(module.nameFormat);var personModuleType=!!nameFormatValues.length;var attrs={};_.each(model.toJSON(),function(val,key){attrs[key]=Handlebars.Utils.escapeExpression(val);});if(personModuleType&&!model.get('name')){var name=new Handlebars.SafeString(app.utils.formatNameModel(model.get('_module'),attrs));model.set('name',name);}
var highlights=model.get('_highlights');if(!highlights){model.formatted=true;return;}
var formattedHighlights=_.map(highlights,function(val,key){if(key==='email'){if(val.primary){val=new Handlebars.SafeString(_.first(val.primary));var label='LBL_PRIMARY_EMAIL';}else{return false;}}else{val=new Handlebars.SafeString(_.first(val));}
attrs[key]=val;return{name:key,value:val,label:label||module.fields[key].vname,link:linkableHighlights,highlighted:true};});formattedHighlights=_.reject(formattedHighlights,function(highlight){return highlight===false;});var highlightedSecondaryEmail=highlights.email?highlights.email.secondary:null;if(highlightedSecondaryEmail){formattedHighlights.push({name:'secondaryEmail',type:'email',value:new Handlebars.SafeString(highlightedSecondaryEmail.join(', ')),label:module.fields['email'].vname,link:linkableHighlights,highlighted:true});}
if(personModuleType){var personName=new Handlebars.SafeString(app.utils.formatNameModel(model.get('_module'),attrs));formattedHighlights.push({name:'name',value:personName,label:module.fields.name.vname,link:linkableHighlights,highlighted:true});}
model.set('_highlights',formattedHighlights);model.formatted=true;});},getFieldsMeta:function(module,options){options=options||{};var fieldsMeta={};var meta=_.extend({},this.meta,app.metadata.getView(module,'search-list'));_.each(meta.panels,function(panel){if(panel.name==='primary'){fieldsMeta.primaryFields=this._setFieldsCategory(panel.fields,'primary',options);}else if(panel.name==='secondary'){fieldsMeta.secondaryFields=this._setFieldsCategory(panel.fields,'secondary',options);}},this);fieldsMeta.rowactions=meta.rowactions;return fieldsMeta;},_setFieldsCategory:function(fields,category,options){var fieldList={};_.each(fields,function(field){if(!fieldList[field.name]){fieldList[field.name]=_.extend({},fieldList[field.name],field);}
fieldList[field.name][category]=true;fieldList[field.name].ellipsis=false;if(category==='primary'&&options.linkablePrimary===false){fieldList[field.name].link=false;}
if(category==='secondary'){fieldList[field.name].link=false;if(field.type==='email'){fieldList[field.name].emailLink=false;}}});return fieldList;},highlightFields:function(model,viewDefs,add){var highlighted=model.get('_highlights');var varDefs=model.fields;viewDefs=_.clone(viewDefs)||{};_.each(highlighted,function(field){var hasViewDefs=viewDefs[field.name];var addOrPatchExisting=(hasViewDefs||add);if(!addOrPatchExisting){return;}
var nameFormatValues=_.values(app.metadata.getModule(model.module).nameFormat);if(_.contains(nameFormatValues,field.name)&&!hasViewDefs){return;}
if(!_.isUndefined(model.primaryFields)&&model.primaryFields[field.name]){return;}
viewDefs[field.name]=_.extend({},varDefs[field.name],viewDefs[field.name],field);});return viewDefs;},buildSearchRoute:function(term,options){options=options||{};term=term?encodeURIComponent(term):'';var paramString='?';var firstParamDefined=false;var modules=options.modules;if(modules&&modules.length>0){paramString=paramString+'modules='+modules.join(',');firstParamDefined=true;}
var tags=options.tags;if(tags&&tags.length>0){if(firstParamDefined){paramString=paramString+'&'}
var encodedTags=_.map(tags,function(tag){return encodeURIComponent(tag);});paramString=paramString+'tags='+encodedTags.join(',');}
return app.router.buildRoute('search',term+paramString);}}});});})(SUGAR.App);
/* End of File include/javascript/sugar7/utils-search.js */


(function(app){var _useRequiredLabels={"bool":true,"radioenum":'edit'};app.events.on("app:init",function(){var _fieldProto=_.clone(app.view.Field.prototype);_.extend(app.view.Field.prototype,{hideHelp:false,exclamationMarkTemplate:Handlebars.compile('<span class="error-tooltip add-on" data-container="body" rel="tooltip" title="{{arrayJoin this ", "}}"><i class="fa fa-exclamation-circle"></i></span>'),handleValidationError:function(errors){this.clearErrorDecoration();_.defer(function(field){field._errors=errors;if(field.parent&&field.parent.action==='edit'){field.parent.render();}else if(field.action==='edit'){field.render();}
if(!field._shouldRenderRequiredPlaceholder()){field.decorateRequired();}
if(field.view&&field.view.trigger){field.view.trigger('field:error',field,true);}},this);this.$el.off("keydown.record");$(document).off("mousedown.record"+this.name);},removeValidationErrors:function(){this._errors={};},_removeViewClass:function(action){this.$el.removeClass(action);},_addViewClass:function(action){this.$el.addClass(action);},showNoData:function(){return this.def.readonly&&app.acl.hasAccessToModel('readonly',this.model,this.name)&&this.name&&!this.model.has(this.name);},_checkAccessToAction:function(action){if(_.contains(this.fallbackActions,action)&&_.isUndefined(this.viewFallbackMap[action])){return true;}
if(_.result(this,'showNoData')===true){return action==='nodata';}
return app.acl.hasAccessToModel(action,this.model,this.name);},viewFallbackMap:{'preview':'detail','list':'detail','edit':'detail','detail':'noaccess','noaccess':'nodata'},fallbackActions:['noaccess','nodata'],_getFallbackTemplate:function(viewName){if(_.contains(this.fallbackActions,viewName)){return viewName;}
return(this.isDisabled()&&viewName==='disabled')?'edit':(this.view.fallbackFieldTemplate||'detail');},_render:function(){this.clearErrorDecoration();this._processHelp();_fieldProto._render.call(this);if(this._previousAction){this._addViewClass(this._previousAction);}
this._addViewClass(this.action);if(!_.isEmpty(this._errors)){if(this.action==='edit'){this.decorateError(this._errors);}}
if(this.def.required){this.clearRequiredLabel();if((this.action==='edit'||-1!==_.indexOf(['edit','list-edit'],this.tplName))&&this._shouldRenderRequiredPlaceholder()){this.decorateRequired();}}
if(this.def.help){this.clearHelper();if(this.action==='edit'||-1!==_.indexOf(['edit','list-edit'],this.tplName)){this.decorateHelper();}}
if($.fn.placeholder){var $input=this.$('input');_.each($input,function(element){var $element=$(element);$element.attr('placeholder')&&$element.placeholder();});}},_processHelp:function(){if(this.meta&&!_.isUndefined(this.meta['hide_help'])){this.hideHelp=!!this.meta['hide_help'];return;}
if(this.view.action==='list'&&this.action==='edit'){this.hideHelp=true;}},clearHelper:function(){this.$el.closest('.record-cell').attr({'rel':''});},decorateHelper:function(){this.$el.closest('.record-cell').attr({'rel':'tooltip','data-title':this.def['help'],'data-placement':'bottom'});},_shouldRenderRequiredPlaceholder:function(){return!this.def.no_required_placeholder;},decorateRequired:function(){var useLabels=_useRequiredLabels[this.type];useLabels=_.isString(useLabels)?(useLabels===this.tplName):useLabels;if(useLabels){this.setRequiredLabel();}else{this.setRequiredPlaceholder();}},setRequiredPlaceholder:function(el){var label=app.lang.get('LBL_REQUIRED_FIELD',this.module),placeholder;el=el||this.$(this.fieldTag).first();placeholder=el.attr('placeholder');placeholder=(placeholder)?'('+label+') '+placeholder:label;el.attr('placeholder',placeholder.trim()).addClass('required');},setRequiredLabel:function(element){var ele=element||this.$el;var $label=ele.closest('.record-cell').find(".record-label");$label.append(' <span data-required="required">('+app.lang.get("LBL_REQUIRED_FIELD",this.module)+')</span>');},clearRequiredLabel:function(element){var ele=element||this.$el;var $label=ele.closest('.record-cell').find('span[data-required]');$label.remove();},setMode:function(name){var oldAction=this._previousAction||this.action;this._removeViewClass(oldAction);_fieldProto.setMode.call(this,name);},setDisabled:function(disable){if(!this._checkAccessToAction('disabled')){return;}
disable=_.isUndefined(disable)?true:disable;if(disable===false&&this.isDisabled()){this._removeViewClass(this.action);}
_fieldProto.setDisabled.call(this,disable);},decorateError:function(errors){var ftag=this.fieldTag||'',$ftag=this.$(ftag),errorMessages=[],$tooltip;this.$el.closest('.record-cell').addClass('error');this.$el.addClass('error');if(_.isString(errors)){errorMessages.push(errors);}else{_.each(errors,function(errorContext,errorName){errorMessages.push(app.error.getErrorString(errorName,errorContext));});}
var isWrapped=$ftag.parent().hasClass('input-append');if(!isWrapped){$ftag.wrap('<div class="input-append '+ftag+'">');}
$ftag.parent().addClass('error');$tooltip=$(this.exclamationMarkTemplate(errorMessages));$ftag.after($tooltip);this.createErrorTooltips($tooltip);},createErrorTooltips:function($element){this._errorTooltips=this._errorTooltips||[];this._errorTooltips.push(app.utils.tooltip.initialize($element));},destroyAllErrorTooltips:function(){if(!this._errorTooltips){return;}
app.utils.tooltip.destroy($(this._errorTooltips));this._errorTooltips=null;},_dispose:function(){this.destroyAllErrorTooltips();_fieldProto._dispose.call(this);},clearErrorDecoration:function(){var ftag=this.fieldTag||'',$ftag=this.$(ftag);this.destroyAllErrorTooltips();this.$('.add-on.error-tooltip').remove();var isWrappedError=$ftag.parent().hasClass('input-append')&&$ftag.parent().hasClass('error');var isDateField=$ftag.parent().hasClass('date'),isCurrencyField=$ftag.parent().hasClass('currency');if(isDateField||isCurrencyField){$ftag.parent().removeClass('error');}else if(isWrappedError){$ftag.unwrap();}
this.$el.removeClass(ftag);this.$el.removeClass("error");this.$el.closest('.record-cell').removeClass("error");if(this.view&&this.view.trigger){this.view.trigger('field:error',this,false);}},delegateEvents:function(events){events=events||this.events||(this.def?this.def.events:null);if(!events){return;}
events['click a[href="javascript:void(0)"]']='_handleBadLinkHref';events['click a[href="javascript:void(0);"]']='_handleBadLinkHref';_fieldProto.delegateEvents.call(this,events);},bindDomChange:function(){this.$(this.fieldTag).on('focus',_.bind(_.debounce(this.handleFocus,40),this));_fieldProto.bindDomChange.call(this);},handleFocus:function(){if(this.disposed){return;}
var $flexList=this.$el.closest('.flex-list-view-content');if(!_.isUndefined($flexList)){var previousScrollLeftValue=$flexList.data('previousScrollLeftValue');if(!_.isUndefined(previousScrollLeftValue)&&$flexList.scrollLeft()!==previousScrollLeftValue){$flexList.scrollLeft(previousScrollLeftValue);$flexList.removeData('previousScrollLeftValue');}}
var left=this.$el.position().left;var right=this.$el.outerWidth()+left;var top=this.$el.offset().top;var bottom=this.$el.outerHeight()+top;var fieldPadding=parseInt(this.$el.parent().css('padding-left'),10);this.view.trigger('field:focus:location',{left:left,right:right,top:top,bottom:bottom,fieldPadding:fieldPadding});},_handleBadLinkHref:function(evt){evt.preventDefault();}});});})(SUGAR.App);
/* End of File include/javascript/sugar7/field.js */


(function(app){var _oldMetadataSet=app.metadata.set;app.metadata.set=function(data){_.each(data.modules,function(module){if(!_.isUndefined(module.fields)){var field=module.fields.team_name;if(field){delete field.len;field.type="teamset";}
_.each(module.fields,function(field){if(field.name&&(field.type==="relate")&&(field.name.length>2&&(field.name.length-
field.name.lastIndexOf("_id"))===3))
{field.type="id";delete field.source;}});}},this);_oldMetadataSet.apply(this,arguments);};})(SUGAR.App);
/* End of File include/javascript/sugar7/hacks.js */


(function(app){app.events.on('app:sync',function(){app.alert.show('app:sync',{level:'process',title:app.lang.get('LBL_LOADING')});});app.events.on('app:sync:complete app:sync:error',function(){app.alert.dismiss('app:sync');});var _contextProto=_.clone(app.Context.prototype);app.Context.prototype.loadData=function(options){if(!this.parent){options=options||{};options.showAlerts=true;}
_contextProto.loadData.call(this,options);};var processAlert={_count:0,dismiss:function(){this._count--;if(this._count<1){this._count=0;app.alert.dismiss('data:sync:process');}},show:function(options){this._count++;app.alert.show('data:sync:process',options);}};app.events.on('data:sync:start',function(method,model,options){options=options||{};if(!options.showAlerts){return;}
if(options.showAlerts.process===false){return;}
var alertOpts={level:'process'};if(method==='read'){alertOpts.title=app.lang.get('LBL_LOADING');}
else if(method==='delete'){alertOpts.title=options.relate?app.lang.get('LBL_UNLINKING'):app.lang.get('LBL_DELETING');}
else{alertOpts.title=app.lang.get('LBL_SAVING');}
if(_.isObject(options.showAlerts.process)){_.extend(alertOpts,options.showAlerts.process);}
processAlert.show(alertOpts);});var syncCompleteHandler=function(type,messages,method,model,options){options=options||{};var alertOpts={level:type,messages:messages};alertOpts.autoClose=(alertOpts.level==='error')?false:true;if(!options.showAlerts)return;if(method==='read')return;if(options.showAlerts[type]===false)return;if(_.isObject(options.showAlerts[type])){_.extend(alertOpts,options.showAlerts[type]);}
app.alert.show('data:sync:'+type,alertOpts);};app.events.on('data:sync:success',function(method,model,options){var messages;if(method==='delete'){messages=options.relate?'LBL_UNLINKED':'LBL_DELETED';}
else{messages='LBL_SAVED';}
syncCompleteHandler('success',messages,method,model,options);});app.events.on('data:sync:error',function(method,model,options,error){var suppressErrorMessageFor=[409,412];if(!error||(!error.handled&&_.indexOf(suppressErrorMessageFor,error.status)===-1)){syncCompleteHandler('error','ERR_GENERIC_SERVER_ERROR',method,model,options);}});app.events.on('data:sync:complete',function(method,model,options){if(options.showAlerts&&options.showAlerts.process!==false){processAlert.dismiss();}});})(SUGAR.App);
/* End of File include/javascript/sugar7/alert.js */


(function(app){app.events.on('app:init',function(){app.lang=_.extend(app.lang,{getModuleSingular:function(module){app.logger.warn('The `app.lang.getModuleSingular` function has been deprecated since 7.6.0. Please '+
+'upgrade your code to use `app.lang.getModuleName`.');var modString=app.metadata.getStrings('mod_strings')[module],moduleSingular=(modString?modString['LBL_MODULE_NAME_SINGULAR']:'')||app.lang.getAppListStrings('moduleListSingular')[module]||app.lang.getAppListStrings('moduleList')[module]||module;return moduleSingular;},getModuleIconLabel:function(module){var name=app.lang.getAppListStrings('moduleIconList')[module]||app.lang.getModuleName(module);var space=name.indexOf(' ');var hasSpace=space!==-1;var result;if(hasSpace){result=name.substring(0,1)+name.substring(space+1,space+2);}else{result=name.substring(0,2);}
return result;}});});app.events.on('app:sync:complete',function(){var language=app.user.getPreference('language')
if(language){language=language.replace('_','-')
app.date.lang(language.toLowerCase());if($.fn.select2.locales){var twoLetterCode=language.substring(0,2).toLowerCase();if(twoLetterCode in $.fn.select2.locales){$.extend($.fn.select2.defaults,$.fn.select2.locales[twoLetterCode]);}
if(language in $.fn.select2.locales){$.extend($.fn.select2.defaults,$.fn.select2.locales[language]);}}}});app.events.on('lang:direction:change',function(){var direction=app.lang.direction,isRTL=direction==='rtl';$('html').toggleClass('rtl',isRTL);});})(SUGAR.App);
/* End of File include/javascript/sugar7/language.js */


(function(app){app.augment("help",{_moduleLabelMap:undefined,get:function(module,view,context){var objModule=_.extend({'module_name':app.lang.getModuleName(module),'plural_module_name':app.lang.getModuleName(module,{plural:true})},context||{},this._getModuleLabelMap()),viewName=this._cleanupViewName(view).toUpperCase();return{'title':this._get('LBL_HELP_'+viewName+'_TITLE',module,objModule),'body':this._get('LBL_HELP_'+viewName,module,objModule),'more_help':this._get('LBL_HELP_MORE_INFO',module,objModule)};},_get:function(label,module,context){var text=app.lang.get(label,module,context);if(_.isEqual(label,text)){return undefined;}
return text;},_cleanupViewName:function(viewName){switch(viewName.toLowerCase()){case'list':return'records';case'detail':return'record';default:return viewName;}},_getModuleLabelMap:function(){if(!_.isUndefined(this._moduleLabelMap)){return this._moduleLabelMap;}
this._moduleLabelMap={};_.each(app.metadata.getModuleNames({filter:'enabled'}),function(module){var key=module.toLowerCase();this._moduleLabelMap[key+'_singular_module']=app.lang.getModuleName(module);this._moduleLabelMap[key+'_module']=app.lang.getModuleName(module,{plural:true});},this);return this._moduleLabelMap;},clearModuleLabelMap:function(){this._moduleLabelMap=undefined;},getMoreInfoHelpURL:function(layoutName,module){layoutName=layoutName||'list';module=module||app.controller.context.get('module');var serverInfo=app.metadata.getServerInfo(),lang=app.lang.getLanguage(),url;if(layoutName=='records'){layoutName='list';}
url='http://www.sugarcrm.com/crm/product_doc.php?edition='+serverInfo.flavor
+'&version='+serverInfo.version+'&lang='+lang+'&module='+module+'&route='+layoutName;if(layoutName=='bwc'){var action=window.location.hash.match(/#bwc.*action=(\w*)/i);if(action&&!_.isUndefined(action[1])){url+='&action='+action[1];}}
return url;}});app.events.on("app:sync:complete",function(){app.help.clearModuleLabelMap();});})(SUGAR.App);
/* End of File include/javascript/sugar7/help.js */


(function(app){app.events.on("app:init",function(){Handlebars.registerHelper('moduleIconLabel',function(module){return app.lang.getModuleIconLabel(module);});Handlebars.registerHelper('moduleIconToolTip',function(module){return app.lang.getModuleName(module);});Handlebars.registerHelper('getDDLabel',function(value,key){return app.lang.getAppListStrings(key)[value]||value;});Handlebars.registerHelper('subViewTemplate',function(key,data,options){var frame,template;template=app.template.getView(key,options.hash.module);frame=_.extend(Handlebars.createFrame(options.data||{}),options.hash);return template?template(data,{data:frame}):'';});Handlebars.registerHelper('subFieldTemplate',function(fieldName,view,data,options){var frame,template;template=app.template.getField(fieldName,view,options.hash.module);frame=_.extend(Handlebars.createFrame(options.data||{}),options.hash);return template?template(data,{data:frame}):'';});Handlebars.registerHelper('subLayoutTemplate',function(key,data,options){var frame,template;template=app.template.getLayout(key,options.hash.module);frame=_.extend(Handlebars.createFrame(options.data||{}),options.hash);return template?template(data,{data:frame}):'';});Handlebars.registerHelper('buildUrl',function(options){return new Handlebars.SafeString(app.utils.buildUrl(options.hash.url));});Handlebars.registerHelper('loading',function(str,options){str=app.lang.get(str);var cssClass=['loading'];if(_.isString(options.hash.cssClass)){cssClass=_.unique(cssClass.concat(Handlebars.Utils.escapeExpression(options.hash.cssClass).split(' ')));}
return new Handlebars.SafeString('<div class="'+cssClass.join(' ')+'">'
+Handlebars.Utils.escapeExpression(str)
+'<i class="l1">&#46;</i><i class="l2">&#46;</i><i class="l3">&#46;</i>'
+'</div>');});});})(SUGAR.App);
/* End of File include/javascript/sugar7/hbs-helpers.js */


(function(app){app.events.on('app:init',function(){_.mixin({moveIndex:function(array,fromIndex,toIndex){array.splice(toIndex,0,_.first(array.splice(fromIndex,1)));return array;}});});})(SUGAR.App);
/* End of File include/javascript/sugar7/underscore-mixins.js */


(function(app){var trackFilterDropdown=function(){if(!app.view.views.BaseFilterFilterDropdownView.prototype){return;}
var _filterDropdownProto=_.clone(app.view.views.BaseFilterFilterDropdownView.prototype);_.extend(app.view.views.BaseFilterFilterDropdownView.prototype,{handleChange:function(id){_filterDropdownProto.handleChange.apply(this,[id]);this.trackGA(id);},trackGA:function(id){app.analytics.trackEvent('click',id+'Filter-selected',id);}});};var trackFilterFieldAndOperator=function(){var currentFieldName;if(!app.view.views.BaseFilterRowsView.prototype){return;}
var _filterFieldOperatorProto=_.clone(app.view.views.BaseFilterRowsView.prototype);_.extend(app.view.views.BaseFilterRowsView.prototype,{handleOperatorSelected:function(e){_filterFieldOperatorProto.handleOperatorSelected.apply(this,[e]);var $el=this.$(e.currentTarget),operator=$el.val();app.analytics.trackEvent(e.type,currentFieldName+"With"+operator,e);},handleFieldSelected:function(e){_filterFieldOperatorProto.handleFieldSelected.apply(this,[e]);var $el=this.$(e.currentTarget),fieldName=$el.val();currentFieldName=fieldName;}});};app.events.on('app:sync:complete',function(){trackFilterDropdown();trackFilterFieldAndOperator();});})(SUGAR.App);
/* End of File include/javascript/sugar7/filter-analytics.js */


(function(app){app.events.on('app:init',function(){var getSystemActions=function(){var actions=[{callback:'openConfig',action:'config',name:app.lang.get('LBL_SWEETSPOT_CONFIG'),icon:'fa-cog'}];return actions;};var hasAccessToAction=function(module,action){if(module&&action.acl_action){if(!app.acl.hasAccess(action.acl_action,module)){return false;}
return action;}
if(action.acl_action==='admin'&&action['label']==='LBL_ADMIN'){if(!app.acl.hasAccessToAny('developer')){return false;}
return action;}
return action;};var getModuleLinks=function(){var actions=[];var moduleList=app.metadata.getModuleNames({filter:'display_tab',access:true});if(app.user.get('type')==='admin'&&app.metadata.getModule('Administration')){moduleList.push('Administration');moduleList=_.uniq(moduleList);}
_.each(moduleList,function(module){var moduleMeta=app.metadata.getModule(module);var menuMeta=moduleMeta&&moduleMeta.menu;var headerMeta=menuMeta&&menuMeta.header&&menuMeta.header.meta||[];var sweetspotMeta=menuMeta&&menuMeta.sweetspot&&menuMeta.sweetspot.meta||[];_.each(headerMeta.concat(sweetspotMeta),function(action){if(hasAccessToAction(action.acl_module||module,action)===false){return;}
var name;var jsFunc='push';var weight;var bwcModuleRoute='#'+app.bwc.buildRoute(module);var sidecarModuleRoute='#'+module;var isIndexRoute=action.route===sidecarModuleRoute||action.route===bwcModuleRoute;var isCreateRoute=(action.route==='#'+module+'/create');if(isIndexRoute){jsFunc='unshift';name=app.lang.getModuleName(module,{plural:true});weight=10;}else if(isCreateRoute){weight=20;name=app.lang.get(action.label,module)}else{weight=30;name=app.lang.get(action.label,module)}
actions[jsFunc]({module:module,label:app.lang.getModuleIconLabel(module),name:name,route:action.route,icon:action.icon,weight:weight});});});var profileActions=app.metadata.getView(null,'profileactions');_.each(profileActions,function(action){if(hasAccessToAction(action.acl_module,action)===false){return;}
actions.push({name:app.lang.get(action.label),route:action.route,icon:action.icon,weight:10});});return actions;};app.metadata.getSweetspotActions=function(){var collection={};var actions=getModuleLinks().concat(getSystemActions());_.each(actions,function(action){if(!action.label){action.label=app.lang.getModuleIconLabel(action.name);}
collection[action.route||action.callback]=action;});return collection;};});})(SUGAR.App);
/* End of File include/javascript/sugar7/sweetspot.js */


(function(app){app.events.on("app:login:success",function(){app.cache.set("show_project_import_warning",true);app.cache.set("show_project_export_warning",true);app.cache.set("show_br_import_warning",true);app.cache.set("show_br_export_warning",true);app.cache.set("show_emailtpl_import_warning",true);app.cache.set("show_emailtpl_export_warning",true);});})(SUGAR.App);
/* End of File include/javascript/sugar7/import-export-warnings.js */

