/*
     * Your installation or use of this SugarCRM file is subject to the applicable
     * terms available at
     * http://support.sugarcrm.com/06_Customer_Center/10_Master_Subscription_Agreements/.
     * If you do not agree to all of the applicable terms or do not have the
     * authority to bind the entity as an authorized representative, then do not
     * install or use this SugarCRM file.
     *
     * Copyright (C) SugarCRM Inc. All rights reserved.
     */
({plugins:['Tooltip'],sidebarClosed:false,fallbackFieldTemplate:"detail",events:{'click [name=name]':'gotoDetail','click .fa-eye':'loadPreview','click [name=show_more_button]':'showMoreResults'},fireSearchRequest:function(cb,offset){var self=this,options;var mlist=app.metadata.getModuleNames({filter:'visible'});options={showAlerts:true,query:self.lastQuery,success:function(collection){cb(collection);},module_list:mlist,error:function(error){cb(null);}};if(offset)options.offset=offset;this.collection.fetch(options);},showMoreResults:function(){var self=this,options={};options.add=true;options.showAlerts=true;options.success=function(){app.view.View.prototype._render.call(self);window.scrollTo(0,document.body.scrollHeight);};this.collection.paginate(options);},gotoDetail:function(evt){var href=this.$(evt.currentTarget).parent().parent().attr('href');window.location=href;},closeSidebar:function(){if(!this.sidebarClosed){app.controller.context.trigger('toggleSidebar');this.sidebarClosed=true;}},initialize:function(options){app.view.View.prototype.initialize.call(this,options);this._addPreviewEvents();},_render:function(){var self=this;self.setHeaderpaneTitle(" ");self.lastQuery=self.context.get('query');self.fireSearchRequest(function(collection){$('.search-query').searchahead('hide');if(self.disposed){return;}
if(collection&&collection.length){app.view.View.prototype._render.call(self);self.setHeaderpaneTitle();}else{self.setHeaderpaneTitle(app.lang.get('LNK_SEARCH_NO_RESULTS'));}});},_addPreviewEvents:function(){app.events.on("list:preview:decorate",this.decorateRow,this);this.collection.on("reset",function(){app.events.trigger("preview:collection:change",this.collection);if(this._previewed){this.decorateRow(this._previewed);}},this);},setHeaderpaneTitle:function(title){if(!title){var context={'query':Handlebars.Utils.escapeExpression(this.lastQuery)};title=app.utils.formatString(app.lang.get('LBL_PORTAL_SEARCH_RESULTS_TITLE'),context);}
this.context.trigger('headerpane:title',title);},decorateRow:function(model){this._previewed=model;this.$("li.search").removeClass("on");if(model){this.$("li.search[data-id="+model.get("id")+"]").addClass("on");}},loadPreview:function(e){var searchRow,selectedResultId,model;if(this.sidebarClosed){app.controller.context.trigger('toggleSidebar');this.sidebarClosed=false;}
searchRow=this.$(e.currentTarget).closest('li.search');selectedResultId=$(searchRow).data("id");model=this.collection.get(selectedResultId);this.decorateRow(model);app.events.trigger("preview:render",model,this.collection,false);}})