/*
     YUI 3.15.0 (build 834026e)
     Copyright 2014 Yahoo! Inc. All rights reserved.
     Licensed under the BSD License.
     http://yuilibrary.com/license/
     */
YUI.add('frame',function(Y,NAME){var Lang=Y.Lang,EVENT_CONTENT_READY='contentready',HOST='host',Frame=function(){Frame.superclass.constructor.apply(this,arguments);};Y.extend(Frame,Y.Plugin.Base,{_ready:null,_rendered:null,_iframe:null,_instance:null,_create:function(cb){var res,html='',timer,create=(this.get('src')===Frame.ATTRS.src.value),extra_css=((this.get('extracss'))?'<style id="extra_css">'+this.get('extracss')+'</style>':'');this._iframe=Y.one(Y.config.doc.createElement('iframe'));this._iframe.setAttrs(Frame.IFRAME_ATTRS);this._iframe.setStyle('visibility','hidden');this._iframe.set('src',this.get('src'));this.get('container').append(this._iframe);this._iframe.set('height','99%');if(create){html=Y.Lang.sub(Frame.PAGE_HTML,{DIR:this.get('dir'),LANG:this.get('lang'),TITLE:this.get('title'),META:Frame.META,LINKED_CSS:this.get('linkedcss'),CONTENT:this.get('content'),BASE_HREF:this.get('basehref'),DEFAULT_CSS:Frame.DEFAULT_CSS,EXTRA_CSS:extra_css});if(Y.config.doc.compatMode!=='BackCompat'){html=Frame.getDocType()+"\n"+html;}else{}}
res=this._resolveWinDoc();if(html){res.doc.open();res.doc.write(html);res.doc.close();}
if(!res.doc.documentElement){timer=Y.later(1,this,function(){if(res.doc&&res.doc.documentElement){cb(res);timer.cancel();}},null,true);}else{cb(res);}},_resolveWinDoc:function(c){var config=(c)?c:{};config.win=Y.Node.getDOMNode(this._iframe.get('contentWindow'));config.doc=Y.Node.getDOMNode(this._iframe.get('contentWindow.document'));if(!config.doc){config.doc=Y.config.doc;}
if(!config.win){config.win=Y.config.win;}
return config;},_onDomEvent:function(e){var xy,node;if(!Y.Node.getDOMNode(this._iframe)){return;}
e.frameX=e.frameY=0;if(e.pageX>0||e.pageY>0){if(e.type.substring(0,3)!=='key'){node=this._instance.one('win');xy=this._iframe.getXY();e.frameX=xy[0]+e.pageX-node.get('scrollLeft');e.frameY=xy[1]+e.pageY-node.get('scrollTop');}}
e.frameTarget=e.target;e.frameCurrentTarget=e.currentTarget;e.frameEvent=e;this.fire('dom:'+e.type,e);},initializer:function(){var host=this.get(HOST);if(host){host.frame=this;}
this.publish('ready',{emitFacade:true,defaultFn:this._defReadyFn});},destructor:function(){var inst=this.getInstance();inst.one('doc').detachAll();inst=null;this._iframe.remove();},_DOMPaste:function(e){var inst=this.getInstance(),data='',win=inst.config.win;if(e._event.originalTarget){data=e._event.originalTarget;}
if(e._event.clipboardData){data=e._event.clipboardData.getData('Text');}
if(win.clipboardData){data=win.clipboardData.getData('Text');if(data===''){if(!win.clipboardData.setData('Text',data)){data=null;}}}
e.frameTarget=e.target;e.frameCurrentTarget=e.currentTarget;e.frameEvent=e;if(data){e.clipboardData={data:data,getData:function(){return data;}};}else{e.clipboardData=null;}
this.fire('dom:paste',e);},_defReadyFn:function(){var inst=this.getInstance();Y.each(Frame.DOM_EVENTS,function(v,k){var fn=Y.bind(this._onDomEvent,this),kfn=((Y.UA.ie&&Frame.THROTTLE_TIME>0)?Y.throttle(fn,Frame.THROTTLE_TIME):fn);if(!inst.Node.DOM_EVENTS[k]){inst.Node.DOM_EVENTS[k]=1;}
if(v===1){if(k!=='focus'&&k!=='blur'&&k!=='paste'){if(k.substring(0,3)==='key'){inst.on(k,kfn,inst.config.doc);}else{inst.on(k,fn,inst.config.doc);}}}},this);inst.Node.DOM_EVENTS.paste=1;inst.on('paste',Y.bind(this._DOMPaste,this),inst.one('body'));inst.on('focus',Y.bind(this._onDomEvent,this),inst.config.win);inst.on('blur',Y.bind(this._onDomEvent,this),inst.config.win);inst.__use=inst.use;inst.use=Y.bind(this.use,this);this._iframe.setStyles({visibility:'inherit'});inst.one('body').setStyle('display','block');},_fixIECursors:function(){var inst=this.getInstance(),tables=inst.all('table'),brs=inst.all('br'),si;if(tables.size()&&brs.size()){si=tables.item(0).get('sourceIndex');brs.each(function(n){var p=n.get('parentNode'),c=p.get('children'),b=p.all('>br');if(p.test('div')){if(c.size()>2){n.replace(inst.Node.create('<wbr>'));}else{if(n.get('sourceIndex')>si){if(b.size()){n.replace(inst.Node.create('<wbr>'));}}else{if(b.size()>1){n.replace(inst.Node.create('<wbr>'));}}}}});}},_onContentReady:function(e){if(!this._ready){this._ready=true;var inst=this.getInstance(),args=Y.clone(this.get('use'));this.fire('contentready');if(e){inst.config.doc=Y.Node.getDOMNode(e.target);}
args.push(Y.bind(function(){if(inst.EditorSelection){inst.EditorSelection.DEFAULT_BLOCK_TAG=this.get('defaultblock');}
if(this.get('designMode')){if(Y.UA.ie){inst.config.doc.body.contentEditable='true';this._ieSetBodyHeight();inst.on('keyup',Y.bind(this._ieSetBodyHeight,this),inst.config.doc);}else{inst.config.doc.designMode='on';}}
this.fire('ready');},this));inst.use.apply(inst,args);inst.one('doc').get('documentElement').addClass('yui-js-enabled');}},_ieHeightCounter:null,_ieSetBodyHeight:function(e){if(!this._ieHeightCounter){this._ieHeightCounter=0;}
this._ieHeightCounter++;var run=false,inst,h,bh;if(!e){run=true;}
if(e){switch(e.keyCode){case 8:case 13:run=true;break;}
if(e.ctrlKey||e.shiftKey){run=true;}}
if(run){try{inst=this.getInstance();h=this._iframe.get('offsetHeight');bh=inst.config.doc.body.scrollHeight;if(h>bh){h=(h-15)+'px';inst.config.doc.body.style.height=h;}else{inst.config.doc.body.style.height='auto';}}catch(e){if(this._ieHeightCounter<100){Y.later(200,this,this._ieSetBodyHeight);}else{}}}},_resolveBaseHref:function(href){if(!href||href===''){href=Y.config.doc.location.href;if(href.indexOf('?')!==-1){href=href.substring(0,href.indexOf('?'));}
href=href.substring(0,href.lastIndexOf('/'))+'/';}
return href;},_getHTML:function(html){if(this._ready){var inst=this.getInstance();html=inst.one('body').get('innerHTML');}
return html;},_setHTML:function(html){if(this._ready){var inst=this.getInstance();inst.one('body').set('innerHTML',html);}else{this.once(EVENT_CONTENT_READY,Y.bind(this._setHTML,this,html));}
return html;},_getLinkedCSS:function(urls){if(!Y.Lang.isArray(urls)){urls=[urls];}
var str='';if(!this._ready){Y.each(urls,function(v){if(v){str+='<link rel="stylesheet" href="'+v+'" type="text/css">';}});}else{str=urls;}
return str;},_setLinkedCSS:function(css){if(this._ready){var inst=this.getInstance();inst.Get.css(css);}
return css;},_setExtraCSS:function(css){if(this._ready){var inst=this.getInstance(),node=inst.one('#extra_css');node.remove();inst.one('head').append('<style id="extra_css">'+css+'</style>');}else{this.once(EVENT_CONTENT_READY,Y.bind(this._setExtraCSS,this,css));}
return css;},_instanceLoaded:function(inst){this._instance=inst;this._onContentReady();var doc=this._instance.config.doc;if(this.get('designMode')){if(!Y.UA.ie){try{doc.execCommand('styleWithCSS',false,false);doc.execCommand('insertbronreturn',false,false);}catch(err){}}}},use:function(){var inst=this.getInstance(),args=Y.Array(arguments),cb=false;if(Y.Lang.isFunction(args[args.length-1])){cb=args.pop();}
if(cb){args.push(function(){cb.apply(inst,arguments);});}
return inst.__use.apply(inst,args);},delegate:function(type,fn,cont,sel){var inst=this.getInstance();if(!inst){return false;}
if(!sel){sel=cont;cont='body';}
return inst.delegate(type,fn,cont,sel);},getInstance:function(){return this._instance;},render:function(node){if(this._rendered){return this;}
this._rendered=true;if(node){this.set('container',node);}
this._create(Y.bind(function(res){var inst,timer,cb=Y.bind(function(i){this._instanceLoaded(i);},this),args=Y.clone(this.get('use')),config={debug:false,win:res.win,doc:res.doc},fn=Y.bind(function(){config=this._resolveWinDoc(config);inst=YUI(config);inst.host=this.get(HOST);try{inst.use('node-base',cb);if(timer){clearInterval(timer);}}catch(e){timer=setInterval(function(){fn();},350);}},this);args.push(fn);Y.use.apply(Y,args);},this));return this;},_handleFocus:function(){var inst=this.getInstance(),sel=new inst.EditorSelection(),n,c,b,par;if(sel.anchorNode){n=sel.anchorNode;if(n.test('p')&&n.get('innerHTML')===''){n=n.get('parentNode');}
c=n.get('childNodes');if(c.size()){if(c.item(0).test('br')){sel.selectNode(n,true,false);}else if(c.item(0).test('p')){n=c.item(0).one('br.yui-cursor');if(n){n=n.get('parentNode');}
if(!n){n=c.item(0).get('firstChild');}
if(!n){n=c.item(0);}
if(n){sel.selectNode(n,true,false);}}else{b=inst.one('br.yui-cursor');if(b){par=b.get('parentNode');if(par){sel.selectNode(par,true,false);}}}}}},_validateLinkedCSS:function(value){return Lang.isString(value)||Lang.isArray(value);},focus:function(fn){if(Y.UA.ie&&Y.UA.ie<9){try{Y.one('win').focus();if(this.getInstance()){if(this.getInstance().one('win')){this.getInstance().one('win').focus();}}}catch(ierr){}
if(fn===true){this._handleFocus();}
if(Y.Lang.isFunction(fn)){fn();}}else{try{Y.one('win').focus();Y.later(100,this,function(){if(this.getInstance()){if(this.getInstance().one('win')){this.getInstance().one('win').focus();}}
if(fn===true){this._handleFocus();}
if(Y.Lang.isFunction(fn)){fn();}});}catch(ferr){}}
return this;},show:function(){this._iframe.setStyles({position:'static',left:''});if(Y.UA.gecko){try{if(this.getInstance()){this.getInstance().config.doc.designMode='on';}}catch(e){}
this.focus();}
return this;},hide:function(){this._iframe.setStyles({position:'absolute',left:'-999999px'});return this;}},{THROTTLE_TIME:100,DOM_EVENTS:{dblclick:1,click:1,paste:1,mouseup:1,mousedown:1,keyup:1,keydown:1,keypress:1,activate:1,deactivate:1,beforedeactivate:1,focusin:1,focusout:1},DEFAULT_CSS:'body { background-color: #fff; font: 13px/1.22 arial,helvetica,clean,sans-serif;*font-size:small;*font:x-small; } a, a:visited, a:hover { color: blue !important; text-decoration: underline !important; cursor: text !important; } img { cursor: pointer !important; border: none; }',IFRAME_ATTRS:{border:'0',frameBorder:'0',marginWidth:'0',marginHeight:'0',leftMargin:'0',topMargin:'0',allowTransparency:'true',width:"100%",height:"99%"},PAGE_HTML:'<html dir="{DIR}" lang="{LANG}"><head><title>{TITLE}</title>{META}<base href="{BASE_HREF}"/>{LINKED_CSS}<style id="editor_css">{DEFAULT_CSS}</style>{EXTRA_CSS}</head><body>{CONTENT}</body></html>',getDocType:function(){var dt=Y.config.doc.doctype,str=Frame.DOC_TYPE;if(dt){str='<!DOCTYPE '+dt.name+((dt.publicId)?' '+dt.publicId:'')+((dt.systemId)?' '+dt.systemId:'')+'>';}else{if(Y.config.doc.all){dt=Y.config.doc.all[0];if(dt.nodeType){if(dt.nodeType===8){if(dt.nodeValue){if(dt.nodeValue.toLowerCase().indexOf('doctype')!==-1){str='<!'+dt.nodeValue+'>';}}}}}}
return str;},DOC_TYPE:'<!DOCTYPE HTML PUBLIC "-/'+'/W3C/'+'/DTD HTML 4.01/'+'/EN" "http:/'+'/www.w3.org/TR/html4/strict.dtd">',META:'<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/><meta http-equiv="X-UA-Compatible" content="IE=7">',NAME:'frame',NS:'frame',ATTRS:{title:{value:'Blank Page'},dir:{value:'ltr'},lang:{value:'en-US'},src:{value:'javascript'+((Y.UA.ie)?':false':':')+';'},designMode:{writeOnce:true,value:false},content:{validator:Lang.isString,value:'<br>',setter:'_setHTML',getter:'_getHTML'},basehref:{value:false,getter:'_resolveBaseHref'},use:{writeOnce:true,value:['node','node-style','selector-css3']},container:{value:'body',setter:function(n){return Y.one(n);}},node:{readOnly:true,value:null,getter:function(){return this._iframe;}},id:{writeOnce:true,getter:function(id){if(!id){id='iframe-'+Y.guid();}
return id;}},linkedcss:{validator:'_validateLinkedCSS',getter:'_getLinkedCSS',setter:'_setLinkedCSS'},extracss:{validator:Lang.isString,setter:'_setExtraCSS'},defaultblock:{value:'p'}}});Y.namespace('Plugin');Y.Plugin.Frame=Frame;Y.Frame=Frame;},'3.15.0',{"requires":["base","node","plugin","selector-css3","yui-throttle"]});