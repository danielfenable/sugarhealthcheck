/*
     YUI 3.15.0 (build 834026e)
     Copyright 2014 Yahoo! Inc. All rights reserved.
     Licensed under the BSD License.
     http://yuilibrary.com/license/
     */
YUI.add('datatable-sort',function(Y,NAME){var YLang=Y.Lang,isBoolean=YLang.isBoolean,isString=YLang.isString,isArray=YLang.isArray,isObject=YLang.isObject,toArray=Y.Array,sub=YLang.sub,dirMap={asc:1,desc:-1,"1":1,"-1":-1};function Sortable(){}
Sortable.ATTRS={sortable:{value:'auto',validator:'_validateSortable'},sortBy:{validator:'_validateSortBy',getter:'_getSortBy'},strings:{}};Y.mix(Sortable.prototype,{sort:function(fields,payload){return this.fire('sort',Y.merge((payload||{}),{sortBy:fields||this.get('sortBy')}));},SORTABLE_HEADER_TEMPLATE:'<div class="{className}" tabindex="0" unselectable="on"><span class="{indicatorClass}"></span></div>',toggleSort:function(columns,payload){var current=this._sortBy,sortBy=[],i,len,j,col,index;for(i=0,len=current.length;i<len;++i){col={};col[current[i]._id]=current[i].sortDir;sortBy.push(col);}
if(columns){columns=toArray(columns);for(i=0,len=columns.length;i<len;++i){col=columns[i];index=-1;for(j=sortBy.length-1;i>=0;--i){if(sortBy[j][col]){sortBy[j][col]*=-1;break;}}}}else{for(i=0,len=sortBy.length;i<len;++i){for(col in sortBy[i]){if(sortBy[i].hasOwnProperty(col)){sortBy[i][col]*=-1;break;}}}}
return this.fire('sort',Y.merge((payload||{}),{sortBy:sortBy}));},_afterSortByChange:function(){this._setSortBy();if(this._sortBy.length){if(!this.data.comparator){this.data.comparator=this._sortComparator;}
this.data.sort();}},_afterSortDataChange:function(e){if(e.prevVal!==e.newVal||e.newVal.hasOwnProperty('_compare')){this._initSortFn();}},_afterSortRecordChange:function(e){var i,len;for(i=0,len=this._sortBy.length;i<len;++i){if(e.changed[this._sortBy[i].key]){this.data.sort();break;}}},_bindSortUI:function(){var handles=this._eventHandles;if(!handles.sortAttrs){handles.sortAttrs=this.after(['sortableChange','sortByChange','columnsChange'],Y.bind('_uiSetSortable',this));}
if(!handles.sortUITrigger&&this._theadNode){handles.sortUITrigger=this.delegate(['click','keydown'],Y.rbind('_onUITriggerSort',this),'.'+this.getClassName('sortable','column'));}},_defSortFn:function(e){this.set.apply(this,['sortBy',e.sortBy].concat(e.details));},_getSortBy:function(val,detail){var state,i,len,col;detail=detail.slice(7);if(detail==='state'){state=[];for(i=0,len=this._sortBy.length;i<len;++i){col=this._sortBy[i];state.push({column:col._id,dir:col.sortDir});}
return{state:(state.length===1)?state[0]:state};}else{return val;}},initializer:function(){var boundParseSortable=Y.bind('_parseSortable',this);this._parseSortable();this._setSortBy();this._initSortFn();this._initSortStrings();this.after({'table:renderHeader':Y.bind('_renderSortable',this),dataChange:Y.bind('_afterSortDataChange',this),sortByChange:Y.bind('_afterSortByChange',this),sortableChange:boundParseSortable,columnsChange:boundParseSortable});this.data.after(this.data.model.NAME+":change",Y.bind('_afterSortRecordChange',this));this.publish('sort',{defaultFn:Y.bind('_defSortFn',this)});},_initSortFn:function(){var self=this;this.data._compare=function(a,b){var cmp=0,i,len,col,dir,cs,aa,bb;for(i=0,len=self._sortBy.length;!cmp&&i<len;++i){col=self._sortBy[i];dir=col.sortDir,cs=col.caseSensitive;if(col.sortFn){cmp=col.sortFn(a,b,(dir===-1));}else{aa=a.get(col.key)||'';bb=b.get(col.key)||'';if(!cs&&typeof(aa)==="string"&&typeof(bb)==="string"){aa=aa.toLowerCase();bb=bb.toLowerCase();}
cmp=(aa>bb)?dir:((aa<bb)?-dir:0);}}
return cmp;};if(this._sortBy.length){this.data.comparator=this._sortComparator;this.data.sort();}else{delete this.data.comparator;}},_initSortStrings:function(){this.set('strings',Y.mix((this.get('strings')||{}),Y.Intl.get('datatable-sort')));},_onUITriggerSort:function(e){var id=e.currentTarget.getAttribute('data-yui3-col-id'),column=id&&this.getColumn(id),sortBy,i,len;if(e.type==='keydown'&&e.keyCode!==32){return;}
e.preventDefault();if(column){if(e.shiftKey){sortBy=this.get('sortBy')||[];for(i=0,len=sortBy.length;i<len;++i){if(id===sortBy[i]||Math.abs(sortBy[i][id])===1){if(!isObject(sortBy[i])){sortBy[i]={};}
sortBy[i][id]=-(column.sortDir||0)||1;break;}}
if(i>=len){sortBy.push(column._id);}}else{sortBy=[{}];sortBy[0][id]=-(column.sortDir||0)||1;}
this.fire('sort',{originEvent:e,sortBy:sortBy});}},_parseSortable:function(){var sortable=this.get('sortable'),columns=[],i,len,col;if(isArray(sortable)){for(i=0,len=sortable.length;i<len;++i){col=sortable[i];if(!isObject(col,true)||isArray(col)){col=this.getColumn(col);}
if(col){columns.push(col);}}}else if(sortable){columns=this._displayColumns.slice();if(sortable==='auto'){for(i=columns.length-1;i>=0;--i){if(!columns[i].sortable){columns.splice(i,1);}}}}
this._sortable=columns;},_renderSortable:function(){this._uiSetSortable();this._bindSortUI();},_setSortBy:function(){var columns=this._displayColumns,sortBy=this.get('sortBy')||[],sortedClass=' '+this.getClassName('sorted'),i,len,name,dir,field,column;this._sortBy=[];for(i=0,len=columns.length;i<len;++i){column=columns[i];delete column.sortDir;if(column.className){column.className=column.className.replace(sortedClass,'');}}
sortBy=toArray(sortBy);for(i=0,len=sortBy.length;i<len;++i){name=sortBy[i];dir=1;if(isObject(name)){field=name;for(name in field){if(field.hasOwnProperty(name)){dir=dirMap[field[name]];break;}}}
if(name){column=this.getColumn(name)||{_id:name,key:name};if(column){column.sortDir=dir;if(!column.className){column.className='';}
column.className+=sortedClass;this._sortBy.push(column);}}}},_sortComparator:function(item){return item;},_uiSetSortable:function(){var columns=this._sortable||[],sortableClass=this.getClassName('sortable','column'),ascClass=this.getClassName('sorted'),descClass=this.getClassName('sorted','desc'),linerClass=this.getClassName('sort','liner'),indicatorClass=this.getClassName('sort','indicator'),sortableCols={},i,len,col,node,liner,title,desc;this.get('boundingBox').toggleClass(this.getClassName('sortable'),columns.length);for(i=0,len=columns.length;i<len;++i){sortableCols[columns[i].id]=columns[i];}
this._theadNode.all('.'+sortableClass).each(function(node){var col=sortableCols[node.get('id')],liner=node.one('.'+linerClass),indicator;if(col){if(!col.sortDir){node.removeClass(ascClass).removeClass(descClass);}}else{node.removeClass(sortableClass).removeClass(ascClass).removeClass(descClass);if(liner){liner.replace(liner.get('childNodes').toFrag());}
indicator=node.one('.'+indicatorClass);if(indicator){indicator.remove().destroy(true);}}});for(i=0,len=columns.length;i<len;++i){col=columns[i];node=this._theadNode.one('#'+col.id);desc=col.sortDir===-1;if(node){liner=node.one('.'+linerClass);node.addClass(sortableClass);if(col.sortDir){node.addClass(ascClass);node.toggleClass(descClass,desc);node.setAttribute('aria-sort',desc?'descending':'ascending');}
if(!liner){liner=Y.Node.create(Y.Lang.sub(this.SORTABLE_HEADER_TEMPLATE,{className:linerClass,indicatorClass:indicatorClass}));liner.prepend(node.get('childNodes').toFrag());node.append(liner);}
title=sub(this.getString((col.sortDir===1)?'reverseSortBy':'sortBy'),{title:col.title||'',key:col.key||'',abbr:col.abbr||'',label:col.label||'',column:col.abbr||col.label||col.key||('column '+i)});node.setAttribute('title',title);node.setAttribute('aria-labelledby',col.id);}}},_validateSortable:function(val){return val==='auto'||isBoolean(val)||isArray(val);},_validateSortBy:function(val){return val===null||isString(val)||isObject(val,true)||(isArray(val)&&(isString(val[0])||isObject(val,true)));}},true);Y.DataTable.Sortable=Sortable;Y.Base.mix(Y.DataTable,[Sortable]);},'3.15.0',{"requires":["datatable-base"],"lang":["en","fr","es","hu"],"skinnable":true});