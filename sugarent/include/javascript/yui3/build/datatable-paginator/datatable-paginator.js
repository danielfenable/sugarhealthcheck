/*
     YUI 3.15.0 (build 834026e)
     Copyright 2014 Yahoo! Inc. All rights reserved.
     Licensed under the BSD License.
     http://yuilibrary.com/license/
     */
YUI.add('datatable-paginator',function(Y,NAME){var Model,View,PaginatorTemplates=Y.DataTable.Templates.Paginator,sub=Y.Lang.sub,getClassName=Y.ClassNameManager.getClassName,CLASS_DISABLED=getClassName(NAME,'control-disabled'),EVENT_UI='paginator:ui';Model=Y.Base.create('dt-pg-model',Y.Model,[Y.Paginator.Core]),View=Y.Base.create('dt-pg-view',Y.View,[],{_eventHandles:[],containerTemplate:'<div class="{paginator}"/>',contentTemplate:'{buttons}{goto}{perPage}',_allowAdHocAttrs:false,initializer:function(){this.containerTemplate=sub(this.containerTemplate,{paginator:getClassName(NAME)});this._initStrings();this._initClassNames();this.attachEvents();},render:function(){var model=this.get('model'),content=sub(this.contentTemplate,{'buttons':this._buildButtonsGroup(),'goto':this._buildGotoGroup(),'perPage':this._buildPerPageGroup()});this.get('container').append(content);this.attachEvents();this._rendered=true;this._updateControlsUI(model.get('page'));this._updateItemsPerPageUI(model.get('itemsPerPage'));return this;},attachEvents:function(){View.superclass.attachEvents.apply(this,arguments);var container=this.get('container');if(!this.classNames){this._initClassNames();}
this._attachedViewEvents.push(container.delegate('click',this._controlClick,'.'+this.classNames.control,this),this.get('model').after('change',this._modelChange,this));container.all('form').each(Y.bind(function(frm){this._attachedViewEvents.push(frm.after('submit',this._controlSubmit,this));},this));container.all('select').each(Y.bind(function(sel){this._attachedViewEvents.push(sel.after('change',this._controlChange,this));},this));},_buildButtonsGroup:function(){var strings=this.get('strings'),classNames=this.classNames,buttons;buttons=PaginatorTemplates.button({type:'first',label:strings.first,classNames:classNames})+
PaginatorTemplates.button({type:'prev',label:strings.prev,classNames:classNames})+
PaginatorTemplates.button({type:'next',label:strings.next,classNames:classNames})+
PaginatorTemplates.button({type:'last',label:strings.last,classNames:classNames});return PaginatorTemplates.buttons({classNames:classNames,buttons:buttons});},_buildGotoGroup:function(){return PaginatorTemplates.gotoPage({classNames:this.classNames,strings:this.get('strings'),page:this.get('model').get('page')});},_buildPerPageGroup:function(){var options=this.get('pageSizes'),rowsPerPage=this.get('model').get('rowsPerPage'),option,len,i;for(i=0,len=options.length;i<len;i++){option=options[i];if(typeof option!=='object'){option={value:option,label:option};}
option.selected=(option.value===rowsPerPage)?' selected':'';}
return PaginatorTemplates.perPage({classNames:this.classNames,strings:this.get('strings'),options:this.get('pageSizes')});},_modelChange:function(e){var changed=e.changed,page=(changed&&changed.page),itemsPerPage=(changed&&changed.itemsPerPage);if(page){this._updateControlsUI(page.newVal);}
if(itemsPerPage){this._updateItemsPerPageUI(itemsPerPage.newVal);if(!page){this._updateControlsUI(e.target.get('page'));}}},_updateControlsUI:function(val){if(!this._rendered){return;}
var model=this.get('model'),controlClass='.'+this.classNames.control,container=this.get('container'),hasPrev=model.hasPrevPage(),hasNext=model.hasNextPage();container.one(controlClass+'-first').toggleClass(CLASS_DISABLED,!hasPrev).set('disabled',!hasPrev);container.one(controlClass+'-prev').toggleClass(CLASS_DISABLED,!hasPrev).set('disabled',!hasPrev);container.one(controlClass+'-next').toggleClass(CLASS_DISABLED,!hasNext).set('disabled',!hasNext);container.one(controlClass+'-last').toggleClass(CLASS_DISABLED,!hasNext).set('disabled',!hasNext);container.one('form input').set('value',val);},_updateItemsPerPageUI:function(val){if(!this._rendered){return;}
this.get('container').one('select').set('value',val);},_controlClick:function(e){e.preventDefault();var control=e.currentTarget;if(control.hasClass(CLASS_DISABLED)){return;}
this.fire(EVENT_UI,{type:control.getData('type'),val:control.getData('page')||null});},_controlChange:function(e){if(e.target.hasClass(CLASS_DISABLED)){return;}
val=e.target.get('value');this.fire(EVENT_UI,{type:'perPage',val:parseInt(val,10)});},_controlSubmit:function(e){if(e.target.hasClass(CLASS_DISABLED)){return;}
e.preventDefault();input=e.target.one('input');this.fire(EVENT_UI,{type:'page',val:+input.get('value')});},_initClassNames:function(){this.classNames={control:getClassName(NAME,'control'),controls:getClassName(NAME,'controls'),group:getClassName(NAME,'group'),perPage:getClassName(NAME,'per-page')};},_initStrings:function(){this.set('strings',Y.mix((this.get('strings')||{}),Y.Intl.get('datatable-paginator')));},_defPageSizeVal:function(){this._initStrings();var str=this.get('strings');return[10,50,100,{label:str.showAll,value:-1}]}},{ATTRS:{pageSizes:{valueFn:'_defPageSizeVal'},model:{}}});function Controller(){}
Controller.ATTRS={paginatorModel:{setter:'_setPaginatorModel',value:null,writeOnce:'initOnly'},paginatorModelType:{getter:'_getConstructor',value:'DataTable.Paginator.Model',writeOnce:'initOnly'},paginatorView:{getter:'_getConstructor',value:'DataTable.Paginator.View',writeOnce:'initOnly'},pageSizes:{setter:'_setPageSizesFn',valueFn:'_defPageSizeVal'},paginatorStrings:{},rowsPerPage:{value:null},paginatorLocation:{value:'footer'}};Y.mix(Controller.prototype,{firstPage:function(){this.get('paginatorModel').set('page',1);return this;},lastPage:function(){var model=this.get('paginatorModel');model.set('page',model.get('totalPages'));return this;},previousPage:function(){this.get('paginatorModel').prevPage();return this;},nextPage:function(){this.get('paginatorModel').nextPage();return this;},initializer:function(){this._initPaginatorStrings();this._augmentData();if(!this._eventHandles.paginatorRender){this._eventHandles.paginatorRender=Y.Do.after(this._paginatorRender,this,'render');}},_paginatorRender:function(){var model=this.get('paginatorModel');this._paginatorRenderUI();model.after('change',this._afterPaginatorModelChange,this);this.after('dataChange',this._afterDataChangeWithPaginator,this);this.after('rowsPerPageChange',this._afterRowsPerPageChange,this);this.data.after(['add','remove','change'],this._afterDataUpdatesWithPaginator,this);model.set('itemsPerPage',this.get('rowsPerPage'));model.set('totalItems',this.get('data').size());},_afterDataChangeWithPaginator:function(){var data=this.get('data'),model=this.get('paginatorModel');model.set('totalItems',data.size());if(model.get('page')!==1){this.firstPage();}else{this._augmentData();data.fire.call(data,'reset',{src:'reset',models:data._items.concat()});}},_afterDataUpdatesWithPaginator:function(){var model=this.get('paginatorModel'),data=this.get('data');model.set('totalItems',data.size());},_afterRowsPerPageChange:function(e){var data=this.get('data'),model=this.get('paginatorModel'),view;if(e.newVal!==null){this._paginatorRenderUI();if(!(data._paged)){this._augmentData();}
data._paged.index=(model.get('page')-1)*model.get('itemsPerPage');data._paged.length=model.get('itemsPerPage');}else{while(this._pgViews.length){view=this._pgViews.shift();view.destroy({remove:true});view._rendered=null;}
data._paged.index=0;data._paged.length=null;}
this.get('paginatorModel').set('itemsPerPage',parseInt(e.newVal,10));},_paginatorRenderUI:function(){if(!this.get('rowsPerPage')){return;}
var views=this._pgViews,ViewClass=this.get('paginatorView'),viewConfig={pageSizes:this.get('pageSizes'),model:this.get('paginatorModel')},locations=this.get('paginatorLocation');if(!Y.Lang.isArray(locations)){locations=[locations];}
if(!views){views=this._pgViews=[];}
Y.Array.each(locations,function(location){var view=new ViewClass(viewConfig),container=view.render().get('container'),row;view.after('*:ui',this._uiPgHandler,this);views.push(view);if(location._node){location.append(container);this.after('destroy',function(){view.destroy({remove:true});});}else if(location==='footer'){if(!this.foot){this.foot=new Y.DataTable.FooterView({host:this});this.foot.render();this.fire('renderFooter',{view:this.foot});}
row=Y.Node.create(PaginatorTemplates.rowWrapper({wrapperClass:getClassName(NAME,'wrapper'),numOfCols:this.get('columns').length}));row.one('td').append(container);this.foot.tfootNode.append(row);view.after('destroy',function(){row.remove(true);});}else if(location==='header'){if(this.view&&this.view.tableNode){this.view.tableNode.insert(container,'before');}else{this.get('contentBox').prepend(container);}}},this);},_uiPgHandler:function(e){var model=this.get('paginatorModel');switch(e.type){case'first':model.set('page',1);break;case'last':model.set('page',model.get('totalPages'));break;case'prev':case'next':model[e.type+'Page']();break;case'page':model.set('page',e.val);break;case'perPage':model.set('itemsPerPage',e.val);model.set('page',1);break;}},_afterPaginatorModelChange:function(){var model=this.get('paginatorModel'),data=this.get('data');if(!data._paged){this._augmentData();}else{data._paged.index=(model.get('page')-1)*model.get('itemsPerPage');data._paged.length=model.get('itemsPerPage');}
data.fire.call(data,'reset',{src:'reset',models:data._items.concat()});},_augmentData:function(){var model=this.get('paginatorModel');if(this.get('rowsPerPage')===null){return;}
Y.mix(this.get('data'),{_paged:{index:(model.get('page')-1)*model.get('itemsPerPage'),length:model.get('itemsPerPage')},getPage:function(){var _pg=this._paged,min=_pg.index;return(_pg.length>=0)?this._items.slice(min,min+_pg.length):this._items.slice(min);},size:function(paged){return(paged&&this._paged.length>=0)?this._paged.length:this._items.length;},each:function(){var args=Array.prototype.slice.call(arguments);args.unshift(this.getPage());Y.Array.each.apply(null,args);return this;}},true);},_setPageSizesFn:function(val){var i,len=val.length,label,value;if(!Y.Lang.isArray(val)){val=[val];len=val.length;}
for(i=0;i<len;i++){if(typeof val[i]!=='object'){label=val[i];value=val[i];if(parseInt(value,10)!=value){value=-1;}
val[i]={label:label,value:value};}}
return val;},_setPaginatorModel:function(model){if(!(model&&model._isYUIModel)){var ModelConstructor=this.get('paginatorModelType');model=new ModelConstructor(model);}
return model;},_getConstructor:function(type){return typeof type==='string'?Y.Object.getValue(Y,type.split('.')):type;},_initPaginatorStrings:function(){this.set('paginatorStrings',Y.mix((this.get('paginatorStrings')||{}),Y.Intl.get('datatable-paginator')));},_defPageSizeVal:function(){this._initPaginatorStrings();var str=this.get('paginatorStrings');return[10,50,100,{label:str.showAll,value:-1}]}},true);Y.DataTable.Paginator=Controller;Y.DataTable.Paginator.Model=Model;Y.DataTable.Paginator.View=View;Y.Base.mix(Y.DataTable,[Y.DataTable.Paginator]);},'3.15.0',{"requires":["model","view","paginator-core","datatable-foot","datatable-paginator-templates"],"lang":["en","fr"],"skinnable":true});