/*
     YUI 3.15.0 (build 834026e)
     Copyright 2014 Yahoo! Inc. All rights reserved.
     Licensed under the BSD License.
     http://yuilibrary.com/license/
     */
YUI.add('exec-command',function(Y,NAME){var ExecCommand=function(){ExecCommand.superclass.constructor.apply(this,arguments);},fixIETags=function(cmd,tag,rule){var inst=this.getInstance(),doc=inst.config.doc,sel=doc.selection.createRange(),o=doc.queryCommandValue(cmd),html,reg,m,p,d,s,c;if(o){html=sel.htmlText;reg=new RegExp(rule,'g');m=html.match(reg);if(m){html=html.replace(rule+';','').replace(rule,'');sel.pasteHTML('<var id="yui-ie-bs">');p=doc.getElementById('yui-ie-bs');d=doc.createElement('div');s=doc.createElement(tag);d.innerHTML=html;if(p.parentNode!==inst.config.doc.body){p=p.parentNode;}
c=d.childNodes;p.parentNode.replaceChild(s,p);Y.each(c,function(f){s.appendChild(f);});sel.collapse();if(sel.moveToElementText){sel.moveToElementText(s);}
sel.select();}}
this._command(cmd);};Y.extend(ExecCommand,Y.Base,{_lastKey:null,_inst:null,command:function(action,value){var fn=ExecCommand.COMMANDS[action];if(fn){return fn.call(this,action,value);}else{return this._command(action,value);}},_command:function(action,value){var inst=this.getInstance();try{try{inst.config.doc.execCommand('styleWithCSS',null,1);}catch(e1){try{inst.config.doc.execCommand('useCSS',null,0);}catch(e2){}}
inst.config.doc.execCommand(action,null,value);}catch(e){}},getInstance:function(){if(!this._inst){this._inst=this.get('host').getInstance();}
return this._inst;},initializer:function(){Y.mix(this.get('host'),{execCommand:function(action,value){return this.exec.command(action,value);},_execCommand:function(action,value){return this.exec._command(action,value);}});this.get('host').on('dom:keypress',Y.bind(function(e){this._lastKey=e.keyCode;},this));},_wrapContent:function(str,override){var useP=(this.getInstance().host.editorPara&&!override?true:false);if(useP){str='<p>'+str+'</p>';}else{str=str+'<br>';}
return str;}},{NAME:'execCommand',NS:'exec',ATTRS:{host:{value:false}},COMMANDS:{wrap:function(cmd,tag){var inst=this.getInstance();return(new inst.EditorSelection()).wrapContent(tag);},inserthtml:function(cmd,html){var inst=this.getInstance();if(inst.EditorSelection.hasCursor()||Y.UA.ie){return(new inst.EditorSelection()).insertContent(html);}else{this._command('inserthtml',html);}},insertandfocus:function(cmd,html){var inst=this.getInstance(),out,sel;if(inst.EditorSelection.hasCursor()){html+=inst.EditorSelection.CURSOR;out=this.command('inserthtml',html);sel=new inst.EditorSelection();sel.focusCursor(true,true);}else{this.command('inserthtml',html);}
return out;},insertbr:function(){var inst=this.getInstance(),sel=new inst.EditorSelection(),html='<var>|</var>',last=null,root=inst.EditorSelection.ROOT,q=(Y.UA.webkit)?'span.Apple-style-span,var':'var',insert=function(n){var c=inst.Node.create('<br>');n.insert(c,'before');return c;};if(sel._selection.pasteHTML){sel._selection.pasteHTML(html);}else{this._command('inserthtml',html);}
root.all(q).each(function(n){var g=true,s;if(Y.UA.webkit){g=false;if(n.get('innerHTML')==='|'){g=true;}}
if(g){last=insert(n);if((!last.previous()||!last.previous().test('br'))&&Y.UA.gecko){s=last.cloneNode();last.insert(s,'after');last=s;}
n.remove();}});if(Y.UA.webkit&&last){insert(last);sel.selectNode(last);}},insertimage:function(cmd,img){return this.command('inserthtml','<img src="'+img+'">');},addclass:function(cmd,cls){var inst=this.getInstance();return(new inst.EditorSelection()).getSelected().addClass(cls);},removeclass:function(cmd,cls){var inst=this.getInstance();return(new inst.EditorSelection()).getSelected().removeClass(cls);},forecolor:function(cmd,val){var inst=this.getInstance(),sel=new inst.EditorSelection(),n;if(!Y.UA.ie){this._command('useCSS',false);}
if(inst.EditorSelection.hasCursor()){if(sel.isCollapsed){if(sel.anchorNode&&(sel.anchorNode.get('innerHTML')==='&nbsp;')){sel.anchorNode.setStyle('color',val);n=sel.anchorNode;}else{n=this.command('inserthtml','<span style="color: '+val+'">'+inst.EditorSelection.CURSOR+'</span>');sel.focusCursor(true,true);}
return n;}else{return this._command(cmd,val);}}else{this._command(cmd,val);}},backcolor:function(cmd,val){var inst=this.getInstance(),sel=new inst.EditorSelection(),n;if(Y.UA.gecko||Y.UA.opera){cmd='hilitecolor';}
if(!Y.UA.ie){this._command('useCSS',false);}
if(inst.EditorSelection.hasCursor()){if(sel.isCollapsed){if(sel.anchorNode&&(sel.anchorNode.get('innerHTML')==='&nbsp;')){sel.anchorNode.setStyle('backgroundColor',val);n=sel.anchorNode;}else{n=this.command('inserthtml','<span style="background-color: '+val+'">'+inst.EditorSelection.CURSOR+'</span>');sel.focusCursor(true,true);}
return n;}else{return this._command(cmd,val);}}else{this._command(cmd,val);}},hilitecolor:function(){return ExecCommand.COMMANDS.backcolor.apply(this,arguments);},fontname2:function(cmd,val){this._command('fontname',val);var inst=this.getInstance(),sel=new inst.EditorSelection();if(sel.isCollapsed&&(this._lastKey!==32)){if(sel.anchorNode.test('font')){sel.anchorNode.set('face',val);}}},fontsize2:function(cmd,val){this._command('fontsize',val);var inst=this.getInstance(),sel=new inst.EditorSelection(),p;if(sel.isCollapsed&&sel.anchorNode&&(this._lastKey!==32)){if(Y.UA.webkit){if(sel.anchorNode.getStyle('lineHeight')){sel.anchorNode.setStyle('lineHeight','');}}
if(sel.anchorNode.test('font')){sel.anchorNode.set('size',val);}else if(Y.UA.gecko){p=sel.anchorNode.ancestor(inst.EditorSelection.DEFAULT_BLOCK_TAG);if(p){p.setStyle('fontSize','');}}}},insertunorderedlist:function(){this.command('list','ul');},insertorderedlist:function(){this.command('list','ol');},list:function(cmd,tag){var inst=this.getInstance(),html,self=this,DIR='dir',cls='yui3-touched',dir,range,div,elm,n,str,s,par,list,lis,useP=(inst.host.editorPara?true:false),tmp,sdir,hasPParent,fc,root=inst.EditorSelection.ROOT,sel=new inst.EditorSelection();cmd='insert'+((tag==='ul')?'un':'')+'orderedlist';if(Y.UA.ie&&Y.UA.ie<11&&!sel.isCollapsed){range=sel._selection;html=range.htmlText;div=inst.Node.create(html)||root;if(div.test('li')||div.one('li')){this._command(cmd,null);return;}
if(div.test(tag)){elm=range.item?range.item(0):range.parentElement();n=inst.one(elm);lis=n.all('li');str='<div>';lis.each(function(l){str=self._wrapContent(l.get('innerHTML'));});str+='</div>';s=inst.Node.create(str);if(n.get('parentNode').test('div')){n=n.get('parentNode');}
if(n&&n.hasAttribute(DIR)){if(useP){s.all('p').setAttribute(DIR,n.getAttribute(DIR));}else{s.setAttribute(DIR,n.getAttribute(DIR));}}
if(useP){n.replace(s.get('innerHTML'));}else{n.replace(s);}
if(range.moveToElementText){range.moveToElementText(s._node);}
range.select();}else{par=Y.one(range.parentElement());if(!par.test(inst.EditorSelection.BLOCKS)){par=par.ancestor(inst.EditorSelection.BLOCKS);}
if(par){if(par.hasAttribute(DIR)){dir=par.getAttribute(DIR);}}
if(html.indexOf('<br>')>-1){html=html.split(/<br>/i);}else{tmp=inst.Node.create(html);ps=tmp?tmp.all('p'):null;if(ps&&ps.size()){html=[];ps.each(function(n){html.push(n.get('innerHTML'));});}else{html=[html];}}
list='<'+tag+' id="ie-list">';Y.each(html,function(v){var a=inst.Node.create(v);if(a&&a.test('p')){if(a.hasAttribute(DIR)){dir=a.getAttribute(DIR);}
v=a.get('innerHTML');}
list+='<li>'+v+'</li>';});list+='</'+tag+'>';range.pasteHTML(list);elm=inst.config.doc.getElementById('ie-list');elm.id='';if(dir){elm.setAttribute(DIR,dir);}
if(range.moveToElementText){range.moveToElementText(elm);}
range.select();}}else if(Y.UA.ie&&Y.UA.ie<11){par=inst.one(sel._selection.parentElement());if(par.test('p')){if(par&&par.hasAttribute(DIR)){dir=par.getAttribute(DIR);}
html=Y.EditorSelection.getText(par);if(html===''){sdir='';if(dir){sdir=' dir="'+dir+'"';}
list=inst.Node.create(Y.Lang.sub('<{tag}{dir}><li></li></{tag}>',{tag:tag,dir:sdir}));par.replace(list);sel.selectNode(list.one('li'));}else{this._command(cmd,null);}}else{this._command(cmd,null);}}else{root.all(tag).addClass(cls);if(sel.anchorNode.test(inst.EditorSelection.BLOCKS)){par=sel.anchorNode;}else{par=sel.anchorNode.ancestor(inst.EditorSelection.BLOCKS);}
if(!par){par=sel.anchorNode.one(inst.EditorSelection.BLOCKS);}
if(par&&par.hasAttribute(DIR)){dir=par.getAttribute(DIR);}
if(par&&par.test(tag)){hasPParent=par.ancestor('p');html=inst.Node.create('<div/>');elm=par.all('li');elm.each(function(h){html.append(self._wrapContent(h.get('innerHTML'),hasPParent));});if(dir){if(useP){html.all('p').setAttribute(DIR,dir);}else{html.setAttribute(DIR,dir);}}
if(useP){html=inst.Node.create(html.get('innerHTML'));}
fc=html.get('firstChild');par.replace(html);sel.selectNode(fc);}else{this._command(cmd,null);}
list=root.all(tag);if(dir){if(list.size()){list.each(function(n){if(!n.hasClass(cls)){n.setAttribute(DIR,dir);}});}}
list.removeClass(cls);}},justify:function(cmd,val){if(Y.UA.webkit){var inst=this.getInstance(),sel=new inst.EditorSelection(),aNode=sel.anchorNode,html,bgColor=aNode.getStyle('backgroundColor');this._command(val);sel=new inst.EditorSelection();if(sel.anchorNode.test('div')){html='<span>'+sel.anchorNode.get('innerHTML')+'</span>';sel.anchorNode.set('innerHTML',html);sel.anchorNode.one('span').setStyle('backgroundColor',bgColor);sel.selectNode(sel.anchorNode.one('span'));}}else{this._command(val);}},justifycenter:function(){this.command('justify','justifycenter');},justifyleft:function(){this.command('justify','justifyleft');},justifyright:function(){this.command('justify','justifyright');},justifyfull:function(){this.command('justify','justifyfull');}}});if(Y.UA.ie&&Y.UA.ie<11){ExecCommand.COMMANDS.bold=function(){fixIETags.call(this,'bold','b','FONT-WEIGHT: bold');};ExecCommand.COMMANDS.italic=function(){fixIETags.call(this,'italic','i','FONT-STYLE: italic');};ExecCommand.COMMANDS.underline=function(){fixIETags.call(this,'underline','u','TEXT-DECORATION: underline');};}
Y.namespace('Plugin');Y.Plugin.ExecCommand=ExecCommand;},'3.15.0',{"requires":["frame"]});