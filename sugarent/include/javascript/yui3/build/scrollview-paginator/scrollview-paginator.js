/*
     YUI 3.15.0 (build 834026e)
     Copyright 2014 Yahoo! Inc. All rights reserved.
     Licensed under the BSD License.
     http://yuilibrary.com/license/
     */
YUI.add('scrollview-paginator',function(Y,NAME){var getClassName=Y.ClassNameManager.getClassName,SCROLLVIEW='scrollview',CLASS_HIDDEN=getClassName(SCROLLVIEW,'hidden'),CLASS_PAGED=getClassName(SCROLLVIEW,'paged'),UI=(Y.ScrollView)?Y.ScrollView.UI_SRC:'ui',INDEX='index',SCROLL_X='scrollX',SCROLL_Y='scrollY',TOTAL='total',DISABLED='disabled',HOST='host',SELECTOR='selector',AXIS='axis',DIM_X='x',DIM_Y='y';function PaginatorPlugin(){PaginatorPlugin.superclass.constructor.apply(this,arguments);}
Y.extend(PaginatorPlugin,Y.Plugin.Base,{initializer:function(config){var paginator=this,host=paginator.get(HOST);paginator._pageDims=[];paginator._pageBuffer=1;paginator._optimizeMemory=false;paginator._host=host;paginator._bb=host._bb;paginator._cb=host._cb;paginator._cIndex=paginator.get(INDEX);paginator._cAxis=paginator.get(AXIS);if(config._optimizeMemory){paginator._optimizeMemory=config._optimizeMemory;}
if(config._pageBuffer){paginator._pageBuffer=config._pageBuffer;}
paginator._bindAttrs();},_bindAttrs:function(){var paginator=this;paginator.after({'indexChange':paginator._afterIndexChange,'axisChange':paginator._afterAxisChange});paginator.beforeHostMethod('scrollTo',paginator._beforeHostScrollTo);paginator.beforeHostMethod('_mousewheel',paginator._beforeHostMousewheel);paginator.beforeHostMethod('_flick',paginator._beforeHostFlick);paginator.afterHostMethod('_onGestureMoveEnd',paginator._afterHostGestureMoveEnd);paginator.afterHostMethod('_uiDimensionsChange',paginator._afterHostUIDimensionsChange);paginator.afterHostMethod('syncUI',paginator._afterHostSyncUI);paginator.afterHostEvent('render',paginator._afterHostRender);paginator.afterHostEvent('scrollEnd',paginator._afterHostScrollEnded);},_afterHostRender:function(){var paginator=this,bb=paginator._bb,host=paginator._host,index=paginator._cIndex,paginatorAxis=paginator._cAxis,pageNodes=paginator._getPageNodes(),size=pageNodes.size(),pageDim=paginator._pageDims[index];if(paginatorAxis[DIM_Y]){host._maxScrollX=pageDim.maxScrollX;}
else if(paginatorAxis[DIM_X]){host._maxScrollY=pageDim.maxScrollY;}
paginator.set(TOTAL,size);if(index!==0){paginator.scrollToIndex(index,0);}
bb.addClass(CLASS_PAGED);paginator._optimize();},_afterHostSyncUI:function(){var paginator=this,host=paginator._host,pageNodes=paginator._getPageNodes(),size=pageNodes.size();paginator.set(TOTAL,size);if(paginator._cAxis===undefined){paginator._set(AXIS,host.get(AXIS));}},_afterHostUIDimensionsChange:function(){var paginator=this,host=paginator._host,dims=host._getScrollDims(),widgetWidth=dims.offsetWidth,widgetHeight=dims.offsetHeight,pageNodes=paginator._getPageNodes();pageNodes.each(function(node,i){var scrollWidth=node.get('scrollWidth'),scrollHeight=node.get('scrollHeight'),maxScrollX=Math.max(0,scrollWidth-widgetWidth),maxScrollY=Math.max(0,scrollHeight-widgetHeight);if(!paginator._pageDims[i]){paginator._pageDims[i]={scrollX:0,scrollY:0,maxScrollX:maxScrollX,maxScrollY:maxScrollY,width:scrollWidth,height:scrollHeight};}else{paginator._pageDims[i].maxScrollX=maxScrollX;paginator._pageDims[i].maxScrollY=maxScrollY;}});},_beforeHostScrollTo:function(x,y,duration,easing,node){var paginator=this,host=paginator._host,gesture=host._gesture,index=paginator._cIndex,paginatorAxis=paginator._cAxis,pageNodes=paginator._getPageNodes(),gestureAxis;if(gesture){gestureAxis=gesture.axis;if(gestureAxis===DIM_Y){x=null;}else{y=null;}
if(paginatorAxis[gestureAxis]===false){node=pageNodes.item(index);}}
return new Y.Do.AlterArgs("new args",[x,y,duration,easing,node]);},_afterHostGestureMoveEnd:function(){if(this._host._gesture.flick){return;}
var paginator=this,host=paginator._host,gesture=host._gesture,index=paginator._cIndex,paginatorAxis=paginator._cAxis,gestureAxis=gesture.axis,isHorizontal=(gestureAxis===DIM_X),delta=gesture[(isHorizontal?'deltaX':'deltaY')],isForward=(delta>0),pageDims=paginator._pageDims[index],halfway=pageDims[(isHorizontal?'width':'height')]/ 2,isHalfway=(Math.abs(delta)>=halfway),canScroll=paginatorAxis[gestureAxis],rtl=host.rtl;if(canScroll){if(isHalfway){paginator[(rtl===isForward?'prev':'next')]();}
else{paginator.scrollToIndex(paginator.get(INDEX));}}},_beforeHostMousewheel:function(e){var paginator=this,host=paginator._host,bb=host._bb,isForward=(e.wheelDelta<0),paginatorAxis=paginator._cAxis;if(bb.contains(e.target)&&paginatorAxis[DIM_Y]){paginator[(isForward?'next':'prev')]();e.preventDefault();return new Y.Do.Prevent();}},_beforeHostFlick:function(e){if(this._host.get(DISABLED)){return false;}
if(this._host._isOutOfBounds()){return new Y.Do.Prevent();}
var paginator=this,host=paginator._host,gesture=host._gesture,paginatorAxis=paginator.get(AXIS),flick=e.flick,velocity=flick.velocity,flickAxis=flick.axis||false,isForward=(velocity<0),canScroll=paginatorAxis[flickAxis],rtl=host.rtl;if(gesture){gesture.flick=flick;}
if(canScroll){paginator[(rtl===isForward?'prev':'next')]();if(paginatorAxis[flickAxis]){return new Y.Do.Prevent();}}},_afterHostScrollEnded:function(){var paginator=this,host=paginator._host,index=paginator._cIndex,scrollX=host.get(SCROLL_X),scrollY=host.get(SCROLL_Y),paginatorAxis=paginator._cAxis;if(paginatorAxis[DIM_Y]){paginator._pageDims[index].scrollX=scrollX;}else{paginator._pageDims[index].scrollY=scrollY;}
paginator._optimize();},_afterIndexChange:function(e){var paginator=this,host=paginator._host,index=e.newVal,pageDims=paginator._pageDims[index],hostAxis=host._cAxis,paginatorAxis=paginator._cAxis;paginator._cIndex=index;if(hostAxis[DIM_X]&&hostAxis[DIM_Y]){if(paginatorAxis[DIM_Y]){host._maxScrollX=pageDims.maxScrollX;host.set(SCROLL_X,pageDims.scrollX,{src:UI});}
else if(paginatorAxis[DIM_X]){host._maxScrollY=pageDims.maxScrollY;host.set(SCROLL_Y,pageDims.scrollY,{src:UI});}}
if(e.src!==UI){paginator.scrollToIndex(index);}},_optimize:function(){if(!this._optimizeMemory){return false;}
var paginator=this,currentIndex=paginator._cIndex,pageNodes=paginator._getStage(currentIndex);paginator._showNodes(pageNodes.visible);paginator._hideNodes(pageNodes.hidden);},_getStage:function(index){var paginator=this,pageBuffer=paginator._pageBuffer,pageCount=paginator.get(TOTAL),pageNodes=paginator._getPageNodes(),start=Math.max(0,index-pageBuffer),end=Math.min(pageCount,index+1+pageBuffer);return{visible:pageNodes.splice(start,end-start),hidden:pageNodes};},_showNodes:function(nodeList){if(nodeList){nodeList.removeClass(CLASS_HIDDEN).setStyle('visibility','');}},_hideNodes:function(nodeList){if(nodeList){nodeList.addClass(CLASS_HIDDEN).setStyle('visibility','hidden');}},_getPageNodes:function(){var paginator=this,host=paginator._host,cb=host._cb,pageSelector=paginator.get(SELECTOR),pageNodes=(pageSelector?cb.all(pageSelector):cb.get('children'));return pageNodes;},next:function(){var paginator=this,scrollview=paginator._host,index=paginator._cIndex,target=index+1,total=paginator.get(TOTAL);if(scrollview.get(DISABLED)){return;}
if(target>=total){return;}
paginator.set(INDEX,target);},prev:function(){var paginator=this,scrollview=paginator._host,index=paginator._cIndex,target=index-1;if(scrollview.get(DISABLED)){return;}
if(target<0){return;}
paginator.set(INDEX,target);},scrollTo:function(){return this.scrollToIndex.apply(this,arguments);},scrollToIndex:function(index,duration,easing){var paginator=this,host=paginator._host,pageNode=paginator._getPageNodes().item(index),scrollAxis=(paginator._cAxis[DIM_X]?SCROLL_X:SCROLL_Y),scrollOffset=pageNode.get(scrollAxis===SCROLL_X?'offsetLeft':'offsetTop');duration=(duration!==undefined)?duration:PaginatorPlugin.TRANSITION.duration;easing=(easing!==undefined)?easing:PaginatorPlugin.TRANSITION.easing;paginator.set(INDEX,index,{src:UI});paginator._showNodes(pageNode);host.set(scrollAxis,scrollOffset,{duration:duration,easing:easing});},_axisSetter:function(val){if(Y.Lang.isString(val)){return{x:(val.match(/x/i)?true:false),y:(val.match(/y/i)?true:false)};}},_afterAxisChange:function(e){this._cAxis=e.newVal;}},{NAME:'pluginScrollViewPaginator',NS:'pages',ATTRS:{axis:{setter:'_axisSetter',writeOnce:'initOnly'},selector:{value:null},index:{value:0},total:{value:0}},TRANSITION:{duration:300,easing:'ease-out'}});Y.namespace('Plugin').ScrollViewPaginator=PaginatorPlugin;},'3.15.0',{"requires":["plugin","classnamemanager"]});