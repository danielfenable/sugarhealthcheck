/*
     YUI 3.15.0 (build 834026e)
     Copyright 2014 Yahoo! Inc. All rights reserved.
     Licensed under the BSD License.
     http://yuilibrary.com/license/
     */
YUI.add('autocomplete-sources',function(Y,NAME){var ACBase=Y.AutoCompleteBase,Lang=Y.Lang,_SOURCE_SUCCESS='_sourceSuccess',MAX_RESULTS='maxResults',REQUEST_TEMPLATE='requestTemplate',RESULT_LIST_LOCATOR='resultListLocator';Y.mix(ACBase.prototype,{_YQL_SOURCE_REGEX:/^(?:select|set|use)\s+/i,_beforeCreateObjectSource:function(source){if(source instanceof Y.Node&&source.get('nodeName').toLowerCase()==='select'){return this._createSelectSource(source);}
if(Y.JSONPRequest&&source instanceof Y.JSONPRequest){return this._createJSONPSource(source);}
return this._createObjectSource(source);},_createIOSource:function(source){var ioSource={type:'io'},that=this,ioRequest,lastRequest,loading;function _sendRequest(request){var cacheKey=request.request;if(that._cache&&cacheKey in that._cache){that[_SOURCE_SUCCESS](that._cache[cacheKey],request);return;}
if(ioRequest&&ioRequest.isInProgress()){ioRequest.abort();}
ioRequest=Y.io(that._getXHRUrl(source,request),{on:{success:function(tid,response){var data;try{data=Y.JSON.parse(response.responseText);}catch(ex){Y.error('JSON parse error',ex);}
if(data){that._cache&&(that._cache[cacheKey]=data);that[_SOURCE_SUCCESS](data,request);}}}});}
ioSource.sendRequest=function(request){lastRequest=request;if(loading){return;}
loading=true;Y.use('io-base','json-parse',function(){ioSource.sendRequest=_sendRequest;_sendRequest(lastRequest);});};return ioSource;},_createJSONPSource:function(source){var jsonpSource={type:'jsonp'},that=this,lastRequest,loading;function _sendRequest(request){var cacheKey=request.request,query=request.query;if(that._cache&&cacheKey in that._cache){that[_SOURCE_SUCCESS](that._cache[cacheKey],request);return;}
source._config.on.success=function(data){that._cache&&(that._cache[cacheKey]=data);that[_SOURCE_SUCCESS](data,request);};source.send(query);}
jsonpSource.sendRequest=function(request){lastRequest=request;if(loading){return;}
loading=true;Y.use('jsonp',function(){if(!(source instanceof Y.JSONPRequest)){source=new Y.JSONPRequest(source,{format:Y.bind(that._jsonpFormatter,that)});}
jsonpSource.sendRequest=_sendRequest;_sendRequest(lastRequest);});};return jsonpSource;},_createSelectSource:function(source){var that=this;return{type:'select',sendRequest:function(request){var options=[];source.get('options').each(function(option){options.push({html:option.get('innerHTML'),index:option.get('index'),node:option,selected:option.get('selected'),text:option.get('text'),value:option.get('value')});});that[_SOURCE_SUCCESS](options,request);}};},_createStringSource:function(source){if(this._YQL_SOURCE_REGEX.test(source)){return this._createYQLSource(source);}else if(source.indexOf('{callback}')!==-1){return this._createJSONPSource(source);}else{return this._createIOSource(source);}},_createYQLSource:function(source){var that=this,yqlSource={type:'yql'},lastRequest,loading,yqlRequest;if(!that.get(RESULT_LIST_LOCATOR)){that.set(RESULT_LIST_LOCATOR,that._defaultYQLLocator);}
function _sendRequest(request){var query=request.query,env=that.get('yqlEnv'),maxResults=that.get(MAX_RESULTS),callback,opts,yqlQuery;yqlQuery=Lang.sub(source,{maxResults:maxResults>0?maxResults:1000,request:request.request,query:query});if(that._cache&&yqlQuery in that._cache){that[_SOURCE_SUCCESS](that._cache[yqlQuery],request);return;}
callback=function(data){that._cache&&(that._cache[yqlQuery]=data);that[_SOURCE_SUCCESS](data,request);};opts={proto:that.get('yqlProtocol')};if(yqlRequest){yqlRequest._callback=callback;yqlRequest._opts=opts;yqlRequest._params.q=yqlQuery;if(env){yqlRequest._params.env=env;}}else{yqlRequest=new Y.YQLRequest(yqlQuery,{on:{success:callback},allowCache:false},env?{env:env}:null,opts);}
yqlRequest.send();}
yqlSource.sendRequest=function(request){lastRequest=request;if(!loading){loading=true;Y.use('yql',function(){yqlSource.sendRequest=_sendRequest;_sendRequest(lastRequest);});}};return yqlSource;},_defaultYQLLocator:function(response){var results=response&&response.query&&response.query.results,values;if(results&&Lang.isObject(results)){values=Y.Object.values(results)||[];results=values.length===1?values[0]:values;if(!Lang.isArray(results)){results=[results];}}else{results=[];}
return results;},_getXHRUrl:function(url,request){var maxResults=this.get(MAX_RESULTS);if(request.query!==request.request){url+=request.request;}
return Lang.sub(url,{maxResults:maxResults>0?maxResults:1000,query:encodeURIComponent(request.query)});},_jsonpFormatter:function(url,proxy,query){var maxResults=this.get(MAX_RESULTS),requestTemplate=this.get(REQUEST_TEMPLATE);if(requestTemplate){url+=requestTemplate(query);}
return Lang.sub(url,{callback:proxy,maxResults:maxResults>0?maxResults:1000,query:encodeURIComponent(query)});}});Y.mix(ACBase.ATTRS,{yqlEnv:{value:null},yqlProtocol:{value:'http'}});Y.mix(ACBase.SOURCE_TYPES,{io:'_createIOSource',jsonp:'_createJSONPSource',object:'_beforeCreateObjectSource',select:'_createSelectSource',string:'_createStringSource',yql:'_createYQLSource'},true);},'3.15.0',{"optional":["io-base","json-parse","jsonp","yql"],"requires":["autocomplete-base"]});