/*
     YUI 3.15.0 (build 834026e)
     Copyright 2014 Yahoo! Inc. All rights reserved.
     Licensed under the BSD License.
     http://yuilibrary.com/license/
     */
YUI.add('file-html5',function(Y,NAME){var Lang=Y.Lang,Bind=Y.bind,Win=Y.config.win;var FileHTML5=function(o){var file=null;if(FileHTML5.isValidFile(o)){file=o;}
else if(FileHTML5.isValidFile(o.file)){file=o.file;}
else{file=false;}
FileHTML5.superclass.constructor.apply(this,arguments);if(file&&FileHTML5.canUpload()){if(!this.get("file")){this._set("file",file);}
if(!this.get("name")){this._set("name",file.name||file.fileName);}
if(this.get("size")!=(file.size||file.fileSize)){this._set("size",file.size||file.fileSize);}
if(!this.get("type")){this._set("type",file.type);}
if(file.hasOwnProperty("lastModifiedDate")&&!this.get("dateModified")){this._set("dateModified",file.lastModifiedDate);}}};Y.extend(FileHTML5,Y.Base,{initializer:function(cfg){if(!this.get("id")){this._set("id",Y.guid("file"));}},_uploadEventHandler:function(event){var xhr=this.get("xhr");switch(event.type){case"progress":this.fire("uploadprogress",{originEvent:event,bytesLoaded:event.loaded,bytesTotal:this.get("size"),percentLoaded:Math.min(100,Math.round(10000*event.loaded/this.get("size"))/100)});this._set("bytesUploaded",event.loaded);break;case"load":if(xhr.status>=200&&xhr.status<=299){this.fire("uploadcomplete",{originEvent:event,data:event.target.responseText});var xhrupload=xhr.upload,boundEventHandler=this.get("boundEventHandler");xhrupload.removeEventListener("progress",boundEventHandler);xhrupload.removeEventListener("error",boundEventHandler);xhrupload.removeEventListener("abort",boundEventHandler);xhr.removeEventListener("load",boundEventHandler);xhr.removeEventListener("error",boundEventHandler);xhr.removeEventListener("readystatechange",boundEventHandler);this._set("xhr",null);}
else{this.fire("uploaderror",{originEvent:event,data:xhr.responseText,status:xhr.status,statusText:xhr.statusText,source:"http"});}
break;case"error":this.fire("uploaderror",{originEvent:event,data:xhr.responseText,status:xhr.status,statusText:xhr.statusText,source:"io"});break;case"abort":this.fire("uploadcancel",{originEvent:event});break;case"readystatechange":this.fire("readystatechange",{readyState:event.target.readyState,originEvent:event});break;}},startUpload:function(url,parameters,fileFieldName){this._set("bytesUploaded",0);this._set("xhr",new XMLHttpRequest());this._set("boundEventHandler",Bind(this._uploadEventHandler,this));var uploadData=new FormData(),fileField=fileFieldName||"Filedata",xhr=this.get("xhr"),xhrupload=this.get("xhr").upload,boundEventHandler=this.get("boundEventHandler");Y.each(parameters,function(value,key){uploadData.append(key,value);});uploadData.append(fileField,this.get("file"));xhr.addEventListener("loadstart",boundEventHandler,false);xhrupload.addEventListener("progress",boundEventHandler,false);xhr.addEventListener("load",boundEventHandler,false);xhr.addEventListener("error",boundEventHandler,false);xhrupload.addEventListener("error",boundEventHandler,false);xhrupload.addEventListener("abort",boundEventHandler,false);xhr.addEventListener("abort",boundEventHandler,false);xhr.addEventListener("loadend",boundEventHandler,false);xhr.addEventListener("readystatechange",boundEventHandler,false);xhr.open("POST",url,true);xhr.withCredentials=this.get("xhrWithCredentials");Y.each(this.get("xhrHeaders"),function(value,key){xhr.setRequestHeader(key,value);});xhr.send(uploadData);this.fire("uploadstart",{xhr:xhr});},cancelUpload:function(){var xhr=this.get('xhr');if(xhr){xhr.abort();}}},{NAME:'file',TYPE:'html5',ATTRS:{id:{writeOnce:"initOnly",value:null},size:{writeOnce:"initOnly",value:0},name:{writeOnce:"initOnly",value:null},dateCreated:{writeOnce:"initOnly",value:null},dateModified:{writeOnce:"initOnly",value:null},bytesUploaded:{readOnly:true,value:0},type:{writeOnce:"initOnly",value:null},file:{writeOnce:"initOnly",value:null},xhr:{readOnly:true,value:null},xhrHeaders:{value:{}},xhrWithCredentials:{value:true},boundEventHandler:{readOnly:true,value:null}},isValidFile:function(file){return(Win&&Win.File&&file instanceof File);},canUpload:function(){return(Win&&Win.FormData&&Win.XMLHttpRequest);}});Y.FileHTML5=FileHTML5;},'3.15.0',{"requires":["base"]});