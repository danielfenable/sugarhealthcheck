/*
     YUI 3.15.0 (build 834026e)
     Copyright 2014 Yahoo! Inc. All rights reserved.
     Licensed under the BSD License.
     http://yuilibrary.com/license/
     */
YUI.add('widget-modality',function(Y,NAME){var WIDGET='widget',RENDER_UI='renderUI',BIND_UI='bindUI',SYNC_UI='syncUI',BOUNDING_BOX='boundingBox',CONTENT_BOX='contentBox',RENDERED='rendered',VISIBLE='visible',Z_INDEX='zIndex',CHANGE='Change',isBoolean=Y.Lang.isBoolean,getCN=Y.ClassNameManager.getClassName,MaskShow="maskShow",MaskHide="maskHide",ClickOutside="clickoutside",FocusOutside="focusoutside",supportsPosFixed=(function()
/*! IS_POSITION_FIXED_SUPPORTED - Juriy Zaytsev (kangax) - http://yura.thinkweb2.com/cft/ */
{var doc=Y.config.doc,isSupported=null,el,root;if(doc.createElement){el=doc.createElement('div');if(el&&el.style){el.style.position='fixed';el.style.top='10px';root=doc.body;if(root&&root.appendChild&&root.removeChild){root.appendChild(el);isSupported=(el.offsetTop===10);root.removeChild(el);}}}
return isSupported;}());function WidgetModal(config){}
var MODAL='modal',MASK='mask',MODAL_CLASSES={modal:getCN(WIDGET,MODAL),mask:getCN(WIDGET,MASK)};WidgetModal.ATTRS={maskNode:{getter:'_getMaskNode',readOnly:true},modal:{value:false,validator:isBoolean},focusOn:{valueFn:function(){return[{eventName:ClickOutside},{eventName:FocusOutside}];},validator:Y.Lang.isArray}};WidgetModal.CLASSES=MODAL_CLASSES;WidgetModal._GET_MASK=function(){var mask=Y.one('.'+MODAL_CLASSES.mask),win=Y.one('win');if(mask){return mask;}
mask=Y.Node.create('<div></div>').addClass(MODAL_CLASSES.mask);if(supportsPosFixed){mask.setStyles({position:'fixed',width:'100%',height:'100%',top:'0',left:'0',display:'block'});}else{mask.setStyles({position:'absolute',width:win.get('winWidth')+'px',height:win.get('winHeight')+'px',top:'0',left:'0',display:'block'});}
return mask;};WidgetModal.STACK=[];WidgetModal.prototype={initializer:function(){Y.after(this._renderUIModal,this,RENDER_UI);Y.after(this._syncUIModal,this,SYNC_UI);Y.after(this._bindUIModal,this,BIND_UI);},destructor:function(){this._uiSetHostVisibleModal(false);},_uiHandlesModal:null,_renderUIModal:function(){var bb=this.get(BOUNDING_BOX);this._repositionMask(this);bb.addClass(MODAL_CLASSES.modal);},_bindUIModal:function(){this.after(VISIBLE+CHANGE,this._afterHostVisibleChangeModal);this.after(Z_INDEX+CHANGE,this._afterHostZIndexChangeModal);this.after("focusOnChange",this._afterFocusOnChange);if(!supportsPosFixed||(Y.UA.ios&&Y.UA.ios<5)||(Y.UA.android&&Y.UA.android<3)){Y.one('win').on('scroll',this._resyncMask,this);}},_syncUIModal:function(){this._uiSetHostVisibleModal(this.get(VISIBLE));},_focus:function(e){var bb=this.get(BOUNDING_BOX),oldTI=bb.get('tabIndex');bb.set('tabIndex',oldTI>=0?oldTI:0);this.focus();},_blur:function(){this.blur();},_getMaskNode:function(){return WidgetModal._GET_MASK();},_uiSetHostVisibleModal:function(visible){var stack=WidgetModal.STACK,maskNode=this.get('maskNode'),isModal=this.get('modal'),topModal,index;if(visible){Y.Array.each(stack,function(modal){modal._detachUIHandlesModal();modal._blur();});stack.unshift(this);this._repositionMask(this);this._uiSetHostZIndexModal(this.get(Z_INDEX));if(isModal){maskNode.show();Y.later(1,this,'_attachUIHandlesModal');if(this.get(RENDERED)){this._focus();}}}else{index=Y.Array.indexOf(stack,this);if(index>=0){stack.splice(index,1);}
this._detachUIHandlesModal();this._blur();if(stack.length){topModal=stack[0];this._repositionMask(topModal);topModal._uiSetHostZIndexModal(topModal.get(Z_INDEX));if(topModal.get('modal')){Y.later(1,topModal,'_attachUIHandlesModal');topModal._focus();}}else{if(maskNode.getStyle('display')==='block'){maskNode.hide();}}}},_uiSetHostZIndexModal:function(zIndex){if(this.get('modal')){this.get('maskNode').setStyle(Z_INDEX,zIndex||0);}},_attachUIHandlesModal:function(){if(this._uiHandlesModal||WidgetModal.STACK[0]!==this){return;}
var bb=this.get(BOUNDING_BOX),maskNode=this.get('maskNode'),focusOn=this.get('focusOn'),focus=Y.bind(this._focus,this),uiHandles=[],i,len,o;for(i=0,len=focusOn.length;i<len;i++){o={};o.node=focusOn[i].node;o.ev=focusOn[i].eventName;o.keyCode=focusOn[i].keyCode;if(!o.node&&!o.keyCode&&o.ev){uiHandles.push(bb.on(o.ev,focus));}
else if(o.node&&!o.keyCode&&o.ev){uiHandles.push(o.node.on(o.ev,focus));}
else if(o.node&&o.keyCode&&o.ev){uiHandles.push(o.node.on(o.ev,focus,o.keyCode));}
else{}}
if(!supportsPosFixed){uiHandles.push(Y.one('win').on('scroll',Y.bind(function(e){maskNode.setStyle('top',maskNode.get('docScrollY'));},this)));}
this._uiHandlesModal=uiHandles;},_detachUIHandlesModal:function(){Y.each(this._uiHandlesModal,function(h){h.detach();});this._uiHandlesModal=null;},_afterHostVisibleChangeModal:function(e){this._uiSetHostVisibleModal(e.newVal);},_afterHostZIndexChangeModal:function(e){this._uiSetHostZIndexModal(e.newVal);},isNested:function(){var length=WidgetModal.STACK.length,retval=(length>1)?true:false;return retval;},_repositionMask:function(nextElem){var currentModal=this.get('modal'),nextModal=nextElem.get('modal'),maskNode=this.get('maskNode'),bb,bbParent;if(currentModal&&!nextModal){maskNode.remove();this.fire(MaskHide);}
else if((!currentModal&&nextModal)||(currentModal&&nextModal)){maskNode.remove();this.fire(MaskHide);bb=nextElem.get(BOUNDING_BOX);bbParent=bb.get('parentNode')||Y.one('body');bbParent.insert(maskNode,bbParent.get('firstChild'));this.fire(MaskShow);}},_resyncMask:function(e){var o=e.currentTarget,offsetX=o.get('docScrollX'),offsetY=o.get('docScrollY'),w=o.get('innerWidth')||o.get('winWidth'),h=o.get('innerHeight')||o.get('winHeight'),mask=this.get('maskNode');mask.setStyles({"top":offsetY+"px","left":offsetX+"px","width":w+'px',"height":h+'px'});},_afterFocusOnChange:function(e){this._detachUIHandlesModal();if(this.get(VISIBLE)){this._attachUIHandlesModal();}}};Y.WidgetModality=WidgetModal;},'3.15.0',{"requires":["base-build","event-outside","widget"],"skinnable":true});